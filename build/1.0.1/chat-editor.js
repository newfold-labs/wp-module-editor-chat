(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{ChatEditor:()=>Ct});var n={};e.r(n),e.d(n,{closeModal:()=>k,disableComplementaryArea:()=>_,enableComplementaryArea:()=>y,openModal:()=>T,pinItem:()=>w,setDefaultComplementaryArea:()=>g,setFeatureDefaults:()=>E,setFeatureValue:()=>v,toggleFeature:()=>A,unpinItem:()=>b});var r={};e.r(r),e.d(r,{getActiveComplementaryArea:()=>N,isComplementaryAreaLoading:()=>S,isFeatureActive:()=>C,isItemPinned:()=>x,isModalActive:()=>R});const a=window.wp.domReady;var o=e.n(a);const s=window.wp.plugins,i=window.wp.data,c=window.wp.editor,l=window.wp.element,d=window.wp.i18n,u=window.wp.deprecated;var p=e.n(u);const m=window.wp.preferences;function h(e){return["core/edit-post","core/edit-site"].includes(e)?(p()(`${e} interface scope`,{alternative:"core interface scope",hint:"core/edit-post and core/edit-site are merging.",version:"6.6"}),"core"):e}function f(e,t){return"core"===e&&"edit-site/template"===t?(p()("edit-site/template sidebar",{alternative:"edit-post/document",version:"6.6"}),"edit-post/document"):"core"===e&&"edit-site/block-inspector"===t?(p()("edit-site/block-inspector sidebar",{alternative:"edit-post/block",version:"6.6"}),"edit-post/block"):t}const g=(e,t)=>({type:"SET_DEFAULT_COMPLEMENTARY_AREA",scope:e=h(e),area:t=f(e,t)}),y=(e,t)=>({registry:n,dispatch:r})=>{t&&(e=h(e),t=f(e,t),n.select(m.store).get(e,"isComplementaryAreaVisible")||n.dispatch(m.store).set(e,"isComplementaryAreaVisible",!0),r({type:"ENABLE_COMPLEMENTARY_AREA",scope:e,area:t}))},_=e=>({registry:t})=>{e=h(e),t.select(m.store).get(e,"isComplementaryAreaVisible")&&t.dispatch(m.store).set(e,"isComplementaryAreaVisible",!1)},w=(e,t)=>({registry:n})=>{if(!t)return;e=h(e),t=f(e,t);const r=n.select(m.store).get(e,"pinnedItems");!0!==r?.[t]&&n.dispatch(m.store).set(e,"pinnedItems",{...r,[t]:!0})},b=(e,t)=>({registry:n})=>{if(!t)return;e=h(e),t=f(e,t);const r=n.select(m.store).get(e,"pinnedItems");n.dispatch(m.store).set(e,"pinnedItems",{...r,[t]:!1})};function A(e,t){return function({registry:n}){p()("dispatch( 'core/interface' ).toggleFeature",{since:"6.0",alternative:"dispatch( 'core/preferences' ).toggle"}),n.dispatch(m.store).toggle(e,t)}}function v(e,t,n){return function({registry:r}){p()("dispatch( 'core/interface' ).setFeatureValue",{since:"6.0",alternative:"dispatch( 'core/preferences' ).set"}),r.dispatch(m.store).set(e,t,!!n)}}function E(e,t){return function({registry:n}){p()("dispatch( 'core/interface' ).setFeatureDefaults",{since:"6.0",alternative:"dispatch( 'core/preferences' ).setDefaults"}),n.dispatch(m.store).setDefaults(e,t)}}function T(e){return{type:"OPEN_MODAL",name:e}}function k(){return{type:"CLOSE_MODAL"}}const N=(0,i.createRegistrySelector)(e=>(t,n)=>{n=h(n);const r=e(m.store).get(n,"isComplementaryAreaVisible");if(void 0!==r)return!1===r?null:t?.complementaryAreas?.[n]}),S=(0,i.createRegistrySelector)(e=>(t,n)=>{n=h(n);const r=e(m.store).get(n,"isComplementaryAreaVisible"),a=t?.complementaryAreas?.[n];return r&&void 0===a}),x=(0,i.createRegistrySelector)(e=>(t,n,r)=>{var a;r=f(n=h(n),r);const o=e(m.store).get(n,"pinnedItems");return null===(a=o?.[r])||void 0===a||a}),C=(0,i.createRegistrySelector)(e=>(t,n,r)=>(p()("select( 'core/interface' ).isFeatureActive( scope, featureName )",{since:"6.0",alternative:"select( 'core/preferences' ).get( scope, featureName )"}),!!e(m.store).get(n,r)));function R(e,t){return e.activeModal===t}const I=(0,i.combineReducers)({complementaryAreas:function(e={},t){switch(t.type){case"SET_DEFAULT_COMPLEMENTARY_AREA":{const{scope:n,area:r}=t;return e[n]?e:{...e,[n]:r}}case"ENABLE_COMPLEMENTARY_AREA":{const{scope:n,area:r}=t;return{...e,[n]:r}}}return e},activeModal:function(e=null,t){switch(t.type){case"OPEN_MODAL":return t.name;case"CLOSE_MODAL":return null}return e}}),D=(0,i.createReduxStore)("core/interface",{reducer:I,actions:n,selectors:r});(0,i.register)(D);const M=window.wp.apiFetch;var L=e.n(M);const O=window.wp.blocks,P=async()=>{const e=j(),t=B();return{page_content:e,...await U(t)}},j=()=>{const e=(0,i.select)("core/block-editor"),t=e.getBlocks().find(e=>"core/post-content"===e.name);return t?e.getBlocks(t.clientId).map(e=>({clientId:e.clientId,content:(0,O.serialize)(e)})):[]},B=()=>(0,i.select)("core/block-editor").getBlocks().filter(e=>"core/template-part"===e.name),z=async(e,t)=>{if(!e||!e.attributes)return"";const{ref:n,slug:r,theme:a}=e.attributes;if(n){const e=await t.getEntityRecord("postType","wp_template_part",n);return e&&e.content&&(e.content.raw||e.content.rendered)||""}if(r&&a){const e=`${a}//${r}`,n=await t.getEntityRecord("postType","wp_template_part",e);if(n&&n.content)return n.content.raw||n.content.rendered||""}if(r){const e=a?{slug:[r],theme:a}:{slug:[r]},n=await t.getEntityRecords("postType","wp_template_part",e);if(Array.isArray(n)&&n.length>0){const e=n.find(e=>e&&e.slug===r&&(!a||e.theme===a))||n[0];return e&&e.content&&(e.content.raw||e.content.rendered)||""}}return""},F=(e,t)=>e.slug||(e.ref?String(e.ref):null)||e.area||`template_part_${t}`,U=async e=>{const t=(0,i.resolveSelect)("core"),n={};for(let r=0;r<e.length;r++){const a=e[r],o=a.attributes||{},s=await z(a,t),i=F(o,r);i&&!n[i]&&(n[i]={clientId:a.clientId,content:s})}return n},H=()=>{const e=(0,i.select)("core/block-editor").getSelectedBlock();return e?{...e,originalContent:(0,O.serialize)(e)}:null},$=async e=>{if(!e||!e.attributes)return null;const{ref:t,slug:n,theme:r}=e.attributes,a=(0,i.resolveSelect)("core");if(t)return await a.getEntityRecord("postType","wp_template_part",t);if(n&&r){const e=`${r}//${n}`,t=await a.getEntityRecord("postType","wp_template_part",e);if(t)return t}if(n){const e=r?{slug:[n],theme:r}:{slug:[n]},t=await a.getEntityRecords("postType","wp_template_part",e);if(Array.isArray(t)&&t.length>0)return t.find(e=>e&&e.slug===n&&(!r||e.theme===r))||t[0]}return null},W=async(e,t)=>{try{const n=await(async e=>{if(e?.attributes?.ref)return e.attributes.ref;const t=await $(e);return t?.id||null})(e);if(!n)throw new Error("Could not resolve template part entity ID");const r=t.map(e=>(0,O.serialize)(e)).join(""),a=(0,i.dispatch)("core");return await a.editEntityRecord("postType","wp_template_part",n,{content:r}),{success:!0,message:"Template part updated successfully",entityId:n,savedRecord:await a.saveEditedEntityRecord("postType","wp_template_part",n)}}catch(e){return console.error("Error updating template part:",e),{success:!1,message:`Failed to update template part: ${e.message}`,error:e}}},G=new class{async executeActions(e){if(!e||!Array.isArray(e))return{success:!0,message:"No actions to execute"};const t=[],n=[];for(const r of e)try{if(!r.action){n.push("Action missing 'action' property");continue}const e=await this.executeAction(r);t.push(e)}catch(e){n.push(e.message),console.error("Action failed:",e)}return{success:0===n.length,message:0===n.length?"All actions executed successfully":"Some actions failed",results:t,errors:n}}async executeAction(e){if("edit_content"===e.action)return this.handleEditContentAction(e);throw new Error(`Unsupported action type: ${e.action}`)}async handleEditContentAction(e){const{data:t}=e;if(!t||!t.content||!Array.isArray(t.content))throw new Error("Edit content action requires data.content array");const n=[],r=[];for(const e of t.content){const t=e.client_id,{changes:a}=e;if(t)if(a&&Array.isArray(a))try{const e=await this.applyContentChanges(t,a);n.push(e)}catch(e){r.push(`Failed to apply changes to ${t}: ${e.message}`),console.error(`Failed to apply changes to block ${t}:`,e)}else r.push(`Content item ${t} missing changes array`);else r.push("Content item missing client_id")}return{type:"edit_content",success:0===r.length,message:0===r.length?"All content changes applied successfully":"Some content changes failed",results:n,errors:r}}async applyContentChanges(e,t){const{getBlock:n}=(0,i.select)("core/block-editor"),r=n(e);if(!r)throw new Error(`Block with clientId ${e} not found`);if((e=>e&&"core/template-part"===e.name)(r))return this.applyTemplatePartChanges(e,r,t);const a={clientId:e,name:r.name,attributes:{...r.attributes},innerBlocks:r.innerBlocks?[...r.innerBlocks]:[]};let o=(0,O.serialize)(r);for(const n of t){const{find:t,replace:r}=n;if("string"!=typeof t||"string"!=typeof r)throw new Error("Change must have find and replace as strings");const a=this.normalizeHtml(o),s=this.normalizeHtml(t),i=this.normalizeHtml(r);console.log({blockHtml:a,find:s,replace:i}),a.includes(s)?o=a.replace(s,i):console.warn(`Find string not found in block ${e}:`,t.substring(0,50))}const s=(0,O.parse)(o);if(!s||0===s.length)throw new Error("Failed to parse updated content into blocks");const c=s[0];if(!c)throw new Error("Failed to parse updated block");const{updateBlockAttributes:l,replaceInnerBlocks:d}=(0,i.dispatch)("core/block-editor");return c.attributes&&l(e,c.attributes),c.innerBlocks&&c.innerBlocks.length>0?d(e,c.innerBlocks.map(e=>this.createBlockFromParsed(e))):r.innerBlocks&&r.innerBlocks.length>0&&d(e,[]),console.log(`Applied ${t.length} change(s) to block ${e} (${r.name})`),{clientId:e,blockName:r.name,changesApplied:t.length,message:`Block ${r.name} content updated successfully`,originalBlock:a}}async applyTemplatePartChanges(e,t,n){const r=await $(t);console.log("Template part - storing original entity:",{hasEntity:!!r,hasContent:!!r?.content,contentType:typeof r?.content,contentKeys:r?.content?Object.keys(r.content):[]});const a={clientId:e,name:t.name,attributes:{...t.attributes},innerBlocks:t.innerBlocks?[...t.innerBlocks]:[],isTemplatePart:!0,entityContent:r?r.content:null},{getBlocks:o}=(0,i.select)("core/block-editor"),s=o(e);if(0===s.length)throw new Error("Template part has no inner blocks to modify");const{updateBlockAttributes:c,replaceInnerBlocks:l}=(0,i.dispatch)("core/block-editor");let d=0;const u=[];for(const e of s){let t=(0,O.serialize)(e),r=!1;for(const e of n){const{find:n,replace:a}=e;if("string"!=typeof n||"string"!=typeof a)throw new Error("Change must have find and replace as strings");const o=this.normalizeHtml(t),s=this.normalizeHtml(n),i=this.normalizeHtml(a);console.log("TEMPLATE PART CHANGE"),console.log({normalizedBlockHtml:o,normalizedFind:s,normalizedReplace:i}),o.includes(s)&&(t=o.replace(s,i),r=!0,d++,console.log("Applied change to template part inner block"))}if(r){const n=(0,O.parse)(t);if(n&&n.length>0){const t=n[0];if(t.attributes&&c(e.clientId,t.attributes),t.innerBlocks&&t.innerBlocks.length>0){const n=t.innerBlocks.map(e=>this.createBlockFromParsed(e));l(e.clientId,n)}u.push(t)}}else u.push(e)}let p=null;return d>0&&(p=await W(t,u),p.success||console.warn("Template part entity update failed:",p.message)),console.log(`Applied ${d} change(s) to template part ${e}`),{clientId:e,blockName:t.name,changesApplied:d,message:"Template part content updated successfully",originalBlock:a,isTemplatePart:!0,entityUpdateResult:p}}async restoreBlocks(e){if(!e||!Array.isArray(e))return{success:!1,message:"No undo data available"};const{updateBlockAttributes:t,replaceInnerBlocks:n}=(0,i.dispatch)("core/block-editor"),{getBlock:r}=(0,i.select)("core/block-editor"),a=[],o=[];for(const s of e)try{const{clientId:e,attributes:i,innerBlocks:c,isTemplatePart:l,entityContent:d}=s;if(!e){o.push("Missing clientId in undo data");continue}if(l&&d){const t=r(e);if(t){const r="string"==typeof d?d:d.raw||d.rendered;if(console.log("Restoring template part:",{clientId:e,hasEntityContent:!!d,contentType:typeof d,contentStringLength:r?.length}),r){const a=(0,O.parse)(r);console.log("Parsed original blocks:",a.length);const s=await W(t,a);console.log("Entity update result:",s),s.success||(console.warn("Failed to restore template part entity:",s.message),o.push(`Template part entity restore failed: ${s.message}`));const i=a.map(e=>this.createBlockFromParsed(e));n(e,i),console.log("Replaced inner blocks in editor:",i.length)}else console.error("No content string to restore for template part")}else console.error("Could not find block with clientId:",e)}else t(e,i),c&&Array.isArray(c)&&n(e,c.map(e=>this.createBlockFromParsed(e)));const u=l?"Template part":"Block";a.push({clientId:e,message:`${u} restored successfully`})}catch(e){o.push(`Failed to restore block: ${e.message}`),console.error("Failed to restore block:",e)}return{success:0===o.length,message:0===o.length?"All blocks restored successfully":"Some blocks failed to restore",results:a,errors:o}}normalizeHtml(e){let t=e.replace(/\s+/g," ").replace(/>\s+</g,"><").replace(/\\\//g,"/").trim();return t=t.replace(/<!--\s*wp:([^\s]+)\s+(\{.*?\})\s*-->/gs,(e,t,n)=>{try{let e=0,r=0;for(let t=0;t<n.length;t++)if("{"===n[t]&&e++,"}"===n[t]&&e--,0===e){r=t+1;break}const a=n.substring(0,r),o=JSON.parse(a);"button"===t&&(delete o.text,delete o.url,delete o.linkTarget,delete o.rel,"a"===o.tagName&&delete o.tagName,"button"===o.type&&delete o.type);const s=Object.keys(o).sort().reduce((e,t)=>(e[t]=o[t],e),{});return`\x3c!-- wp:${t} ${JSON.stringify(s)} --\x3e`}catch(t){return e}}),t}createBlockFromParsed(e){const t=e.innerBlocks?e.innerBlocks.map(e=>this.createBlockFromParsed(e)):[];return(0,O.createBlock)(e.name,e.attributes||{},t)}},q=G,Y=async()=>({page:{page_id:(0,i.select)("core/editor").getCurrentPostId(),page_title:(0,i.select)("core/editor").getEditedPostAttribute("title")||"",selected_block:H(),content:await P()}}),V=async()=>{try{return await L()({path:"/nfd-editor-chat/v1/chat/new",method:"POST"})}catch(e){throw console.error("Error creating new conversation:",e),e}},X="nfd-editor-chat-conversation-id",K="nfd-editor-chat-messages",J=()=>{try{return localStorage.getItem(X)}catch(e){return console.warn("Failed to load conversation ID from localStorage:",e),null}},Z=()=>{const e=J(),t=(()=>{try{const e=localStorage.getItem(K);return e?JSON.parse(e).map(e=>{const{hasActions:t,undoData:n,...r}=e;return r}):[]}catch(e){return console.warn("Failed to load messages from localStorage:",e),[]}})(),[n,r]=(0,l.useState)(t||[]),[a,o]=(0,l.useState)(!1),[s,c]=(0,l.useState)(e),[u,p]=(0,l.useState)(null),[m,h]=(0,l.useState)(null),[f,g]=(0,l.useState)(!1),y=(0,l.useRef)(!1),_=(0,l.useRef)(null),w=(0,l.useRef)(null),b=(0,l.useRef)(null),{savePost:A}=(0,i.useDispatch)("core/editor"),v=(0,i.useSelect)(e=>e("core/editor").isSavingPost(),[]);(0,l.useEffect)(()=>{f&&!v&&(r(e=>e.map(e=>{if(e.hasActions){const{hasActions:t,undoData:n,...r}=e;return r}return e})),g(!1))},[f,v]),(0,l.useEffect)(()=>{y.current||(y.current=!0,J()||(async()=>{try{const e=await V();e.conversationId&&c(e.conversationId)}catch(e){console.error("Failed to initialize conversation:",e)}})())},[]),(0,l.useEffect)(()=>{(e=>{try{e?localStorage.setItem(X,e):localStorage.removeItem(X)}catch(e){console.warn("Failed to save conversation ID to localStorage:",e)}})(s)},[s]),(0,l.useEffect)(()=>{n.length>0&&(e=>{try{localStorage.setItem(K,JSON.stringify(e))}catch(e){console.warn("Failed to save messages to localStorage:",e)}})(n)},[n]),(0,l.useEffect)(()=>()=>{_.current&&(clearInterval(_.current),_.current=null),w.current&&(clearTimeout(w.current),w.current=null)},[]);const E=()=>{_.current&&(clearInterval(_.current),_.current=null),w.current&&(clearTimeout(w.current),w.current=null),b.current=null};return{messages:n,isLoading:a,conversationId:s,error:u,status:m,isSaving:f,handleSendMessage:async e=>{if(p(null),h(null),!s)return void p((0,d.__)("No active conversation. Please refresh the page and try again.","wp-module-editor-chat"));const t={type:"user",content:e};r(e=>[...e,t]),o(!0),h("received");try{const t=await(async(e,t)=>{try{console.log("sendMessage: Starting API call");const n={message:t,context:await Y(),conversationId:e};console.log("sendMessage: Request data prepared, calling API");const r=await L()({path:"/nfd-editor-chat/v1/chat",method:"POST",data:n});return console.log("sendMessage: API response received:",r),r}catch(e){throw console.error("Error sending message:",e),e}})(s,e);if(!t.message_id)throw console.error("No message_id in response:",t),new Error("No message_id received from API");const a=t.message_id;setTimeout(()=>{(e=>{E(),b.current=Date.now();const t=12e4,a=async()=>{try{if(Date.now()-b.current>=t)return E(),p((0,d.__)("The request is taking longer than expected. Please try again or refresh the page.","wp-module-editor-chat")),o(!1),void h(null);const a=await(async e=>{try{console.log("checkStatus: Calling API with message_id:",e);const t=await L()({path:"/nfd-editor-chat/v1/chat/status",method:"POST",data:{message_id:e}});return console.log("checkStatus: API response:",t),t}catch(e){throw console.error("Error checking status:",e),e}})(e),s=a.status;if(h(s),"completed"===s){if(E(),a.data){const e=a.data;let t="I received your message.";e.chat?.current_message?.assistant&&(t=e.chat.current_message.assistant);let o=!1,s=null;if(e.actions&&Array.isArray(e.actions)&&e.actions.length>0)try{if(n.some(e=>e.hasActions)){const t=n.find(e=>e.hasActions&&e.undoData);s=t?t.undoData:null,await q.executeActions(e.actions),o=!0}else{const t=await q.executeActions(e.actions);o=!0,t.results&&t.results.length>0&&(s=[],t.results.forEach(e=>{e.results&&Array.isArray(e.results)&&e.results.forEach(e=>{e.originalBlock&&s.push(e.originalBlock)})}))}}catch(e){console.error("Error executing actions:",e)}const i={type:"assistant",content:t,hasActions:o,undoData:s};r(e=>[...e,i])}o(!1),h(null)}else"failed"===s&&(E(),p((0,d.__)("Sorry, I encountered an error processing your request. Please try again.","wp-module-editor-chat")),o(!1),h(null))}catch(e){console.error("Error checking status:",e),Date.now()-b.current>=t&&(E(),p((0,d.__)("The request is taking longer than expected. Please try again or refresh the page.","wp-module-editor-chat")),o(!1),h(null))}};a(),_.current=setInterval(a,4e3),w.current=setTimeout(()=>{E(),p((0,d.__)("The request is taking longer than expected. Please try again or refresh the page.","wp-module-editor-chat")),o(!1),h(null)},t)})(a)},0)}catch(e){console.error("Error sending message:",e),p((0,d.__)("Sorry, I encountered an error processing your request. Please try again.","wp-module-editor-chat")),o(!1),h(null)}},handleNewChat:async()=>{r([]),c(null),p(null),(()=>{try{localStorage.removeItem(X),localStorage.removeItem(K)}catch(e){console.warn("Failed to clear chat data from localStorage:",e)}})();try{const e=await V();e.conversationId&&c(e.conversationId)}catch(e){console.error("Failed to create new conversation:",e)}},handleAcceptChanges:()=>{g(!0),A&&A()},handleDeclineChanges:async()=>{const e=n.find(e=>e.hasActions&&e.undoData);if(e&&e.undoData)try{await q.restoreBlocks(e.undoData),r(e=>e.map(e=>{if(e.hasActions){const{hasActions:t,undoData:n,...r}=e;return r}return e}))}catch(e){console.error("Error restoring blocks:",e)}else console.error("No undo data available")}}},Q=window.wp.components,ee=window.React,te=(...e)=>e.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim();var ne={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const re=(0,ee.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:a="",children:o,iconNode:s,...i},c)=>(0,ee.createElement)("svg",{ref:c,...ne,width:t,height:t,stroke:e,strokeWidth:r?24*Number(n)/Number(t):n,className:te("lucide",a),...i},[...s.map(([e,t])=>(0,ee.createElement)(e,t)),...Array.isArray(o)?o:[o]])),ae=(e,t)=>{const n=(0,ee.forwardRef)(({className:n,...r},a)=>{return(0,ee.createElement)(re,{ref:a,iconNode:t,className:te(`lucide-${o=e,o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,n),...r});var o});return n.displayName=`${e}`,n},oe=ae("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),se=ae("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),ie=window.ReactJSXRuntime,ce=({pendingCount:e,onAccept:t,onDecline:n,isSaving:r})=>{const a=1===e?"change":"changes";return(0,ie.jsxs)("div",{className:"nfd-editor-chat-action-buttons",children:[(0,ie.jsxs)("div",{className:"nfd-editor-chat-action-buttons__indicator",children:[(0,ie.jsx)("span",{className:"nfd-editor-chat-action-buttons__indicator-dot"}),e," pending ",a]}),(0,ie.jsxs)("div",{className:"nfd-editor-chat-action-buttons__buttons",children:[(0,ie.jsxs)(Q.Button,{className:"nfd-editor-chat-action-buttons__button nfd-editor-chat-action-buttons__button--decline",onClick:n,disabled:r,children:[(0,ie.jsx)(oe,{size:12}),"Revert All"]}),(0,ie.jsxs)(Q.Button,{className:"nfd-editor-chat-action-buttons__button nfd-editor-chat-action-buttons__button--accept",onClick:t,disabled:r,children:[(0,ie.jsx)(se,{size:14}),"Keep Changes"]})]})]})},le=ae("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),de=ae("AtSign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),ue=({block:e,onRemove:t})=>{if(!e)return null;const n=(r=e.name)?r.split("/").pop().split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"";var r;const a=e.attributes?.metadata?.name,o=e.name.split("/").pop(),s=["paragraph","heading"].includes(o),i=e.attributes?.content,c=s?(l=i)&&l.replace(/<[^>]*>/g,"").trim()||null:null;var l;let u=n;a?u=`${n}: ${a}`:c&&(u=`${n}: ${c}`);const p=u;return u.length>30&&(u=`${u.substring(0,30)}...`),(0,ie.jsxs)("div",{className:"nfd-editor-chat-context-tag",title:p,children:[(0,ie.jsx)("span",{className:"nfd-editor-chat-context-tag__label",children:(0,ie.jsx)(de,{size:12})}),t&&(0,ie.jsx)("button",{className:"nfd-editor-chat-context-tag__remove",onClick:()=>t(e.clientId),"aria-label":(0,d.__)("Remove context","wp-module-editor-chat"),children:(0,ie.jsx)(oe,{size:12})}),(0,ie.jsx)("span",{className:"nfd-editor-chat-context-tag__block",children:u})]})},pe=({onSendMessage:e,disabled:t=!1})=>{const[n,r]=(0,l.useState)(""),a=(0,l.useRef)(null),o=(0,i.useSelect)(()=>H(),[]),{clearSelectedBlock:s}=(0,i.useDispatch)("core/block-editor");(0,l.useEffect)(()=>{if(a.current){a.current.style.height="auto";const e=Math.min(a.current.scrollHeight,200);a.current.style.height=`${e}px`}},[n]),(0,l.useEffect)(()=>{!t&&a.current&&setTimeout(()=>{a.current.focus()},100)},[t]);const c=()=>{n.trim()&&!t&&(e(n),r(""),a.current&&(a.current.style.height="auto",a.current.focus()))};return(0,ie.jsxs)("div",{className:"nfd-editor-chat-input",children:[(0,ie.jsxs)("div",{className:"nfd-editor-chat-input__container",children:[(0,ie.jsx)("textarea",{name:"nfd-editor-chat-input",ref:a,value:n,onChange:e=>r(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),c())},placeholder:(0,d.__)("How can I help you today?","wp-module-editor-chat"),className:"nfd-editor-chat-input__textarea",rows:1,disabled:t}),(0,ie.jsxs)("div",{className:"nfd-editor-chat-input__actions",children:[o&&(0,ie.jsx)(ue,{block:o,onRemove:e=>{s(e)}}),(0,ie.jsx)(Q.Button,{icon:(0,ie.jsx)(le,{width:16,height:16}),label:(0,d.__)("Send message","wp-module-editor-chat"),onClick:c,className:"nfd-editor-chat-input__submit",disabled:t||!n.trim()})]})]}),(0,ie.jsx)("div",{className:"nfd-editor-chat-input__disclaimer",children:(0,d.__)("AI-generated content is not guaranteed for accuracy.","wp-module-editor-chat")})]})},me=ae("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),he=({message:e,className:t=""})=>(0,ie.jsxs)("div",{className:`nfd-editor-chat-error-alert ${t}`,children:[(0,ie.jsx)("div",{className:"nfd-editor-chat-error-alert__icon",children:(0,ie.jsx)(me,{width:16,height:16})}),(0,ie.jsx)("div",{className:"nfd-editor-chat-error-alert__content",children:(0,ie.jsx)("div",{className:"nfd-editor-chat-error-alert__message",children:e})})]}),fe=({status:e=null})=>(0,ie.jsx)("div",{className:"nfd-editor-chat-message nfd-editor-chat-message--assistant",children:(0,ie.jsx)("div",{className:"nfd-editor-chat-message__content",children:(0,ie.jsxs)("div",{className:"nfd-editor-chat-typing-indicator",children:[(0,ie.jsx)("div",{className:"nfd-editor-chat-typing-indicator__loader"}),e&&(0,ie.jsx)("div",{className:"nfd-editor-chat-typing-indicator__status",children:(()=>{switch(e){case"received":return(0,d.__)("Message received...","wp-module-editor-chat");case"generating":return(0,d.__)("Generating response...","wp-module-editor-chat");case"completed":return(0,d.__)("Processing...","wp-module-editor-chat");case"failed":return(0,d.__)("Error occurred","wp-module-editor-chat");default:return(0,d.__)("Thinking...","wp-module-editor-chat")}})()})]})})}),{entries:ge,setPrototypeOf:ye,isFrozen:_e,getPrototypeOf:we,getOwnPropertyDescriptor:be}=Object;let{freeze:Ae,seal:ve,create:Ee}=Object,{apply:Te,construct:ke}="undefined"!=typeof Reflect&&Reflect;Ae||(Ae=function(e){return e}),ve||(ve=function(e){return e}),Te||(Te=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return e.apply(t,r)}),ke||(ke=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new e(...n)});const Ne=Ue(Array.prototype.forEach),Se=Ue(Array.prototype.lastIndexOf),xe=Ue(Array.prototype.pop),Ce=Ue(Array.prototype.push),Re=Ue(Array.prototype.splice),Ie=Ue(String.prototype.toLowerCase),De=Ue(String.prototype.toString),Me=Ue(String.prototype.match),Le=Ue(String.prototype.replace),Oe=Ue(String.prototype.indexOf),Pe=Ue(String.prototype.trim),je=Ue(Object.prototype.hasOwnProperty),Be=Ue(RegExp.prototype.test),ze=(Fe=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return ke(Fe,t)});var Fe;function Ue(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return Te(e,t,r)}}function He(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ie;ye&&ye(e,null);let r=t.length;for(;r--;){let a=t[r];if("string"==typeof a){const e=n(a);e!==a&&(_e(t)||(t[r]=e),a=e)}e[a]=!0}return e}function $e(e){for(let t=0;t<e.length;t++)je(e,t)||(e[t]=null);return e}function We(e){const t=Ee(null);for(const[n,r]of ge(e))je(e,n)&&(Array.isArray(r)?t[n]=$e(r):r&&"object"==typeof r&&r.constructor===Object?t[n]=We(r):t[n]=r);return t}function Ge(e,t){for(;null!==e;){const n=be(e,t);if(n){if(n.get)return Ue(n.get);if("function"==typeof n.value)return Ue(n.value)}e=we(e)}return function(){return null}}const qe=Ae(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Ye=Ae(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Ve=Ae(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Xe=Ae(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Ke=Ae(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Je=Ae(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ze=Ae(["#text"]),Qe=Ae(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),et=Ae(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),tt=Ae(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),nt=Ae(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),rt=ve(/\{\{[\w\W]*|[\w\W]*\}\}/gm),at=ve(/<%[\w\W]*|[\w\W]*%>/gm),ot=ve(/\$\{[\w\W]*/gm),st=ve(/^data-[\-\w.\u00B7-\uFFFF]+$/),it=ve(/^aria-[\-\w]+$/),ct=ve(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),lt=ve(/^(?:\w+script|data):/i),dt=ve(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),ut=ve(/^html$/i),pt=ve(/^[a-z][.\w]*(-[.\w]+)+$/i);var mt=Object.freeze({__proto__:null,ARIA_ATTR:it,ATTR_WHITESPACE:dt,CUSTOM_ELEMENT:pt,DATA_ATTR:st,DOCTYPE_NAME:ut,ERB_EXPR:at,IS_ALLOWED_URI:ct,IS_SCRIPT_OR_DATA:lt,MUSTACHE_EXPR:rt,TMPLIT_EXPR:ot});const ht=function(){return"undefined"==typeof window?null:window};var ft=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ht();const n=t=>e(t);if(n.version="3.3.0",n.removed=[],!t||!t.document||9!==t.document.nodeType||!t.Element)return n.isSupported=!1,n;let{document:r}=t;const a=r,o=a.currentScript,{DocumentFragment:s,HTMLTemplateElement:i,Node:c,Element:l,NodeFilter:d,NamedNodeMap:u=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:p,DOMParser:m,trustedTypes:h}=t,f=l.prototype,g=Ge(f,"cloneNode"),y=Ge(f,"remove"),_=Ge(f,"nextSibling"),w=Ge(f,"childNodes"),b=Ge(f,"parentNode");if("function"==typeof i){const e=r.createElement("template");e.content&&e.content.ownerDocument&&(r=e.content.ownerDocument)}let A,v="";const{implementation:E,createNodeIterator:T,createDocumentFragment:k,getElementsByTagName:N}=r,{importNode:S}=a;let x={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};n.isSupported="function"==typeof ge&&"function"==typeof b&&E&&void 0!==E.createHTMLDocument;const{MUSTACHE_EXPR:C,ERB_EXPR:R,TMPLIT_EXPR:I,DATA_ATTR:D,ARIA_ATTR:M,IS_SCRIPT_OR_DATA:L,ATTR_WHITESPACE:O,CUSTOM_ELEMENT:P}=mt;let{IS_ALLOWED_URI:j}=mt,B=null;const z=He({},[...qe,...Ye,...Ve,...Ke,...Ze]);let F=null;const U=He({},[...Qe,...et,...tt,...nt]);let H=Object.seal(Ee(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),$=null,W=null;const G=Object.seal(Ee(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let q=!0,Y=!0,V=!1,X=!0,K=!1,J=!0,Z=!1,Q=!1,ee=!1,te=!1,ne=!1,re=!1,ae=!0,oe=!1,se=!0,ie=!1,ce={},le=null;const de=He({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ue=null;const pe=He({},["audio","video","img","source","image","track"]);let me=null;const he=He({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),fe="http://www.w3.org/1998/Math/MathML",ye="http://www.w3.org/2000/svg",_e="http://www.w3.org/1999/xhtml";let we=_e,be=!1,ve=null;const Te=He({},[fe,ye,_e],De);let ke=He({},["mi","mo","mn","ms","mtext"]),Fe=He({},["annotation-xml"]);const Ue=He({},["title","style","font","a","script"]);let $e=null;const rt=["application/xhtml+xml","text/html"];let at=null,ot=null;const st=r.createElement("form"),it=function(e){return e instanceof RegExp||e instanceof Function},lt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!ot||ot!==e){if(e&&"object"==typeof e||(e={}),e=We(e),$e=-1===rt.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,at="application/xhtml+xml"===$e?De:Ie,B=je(e,"ALLOWED_TAGS")?He({},e.ALLOWED_TAGS,at):z,F=je(e,"ALLOWED_ATTR")?He({},e.ALLOWED_ATTR,at):U,ve=je(e,"ALLOWED_NAMESPACES")?He({},e.ALLOWED_NAMESPACES,De):Te,me=je(e,"ADD_URI_SAFE_ATTR")?He(We(he),e.ADD_URI_SAFE_ATTR,at):he,ue=je(e,"ADD_DATA_URI_TAGS")?He(We(pe),e.ADD_DATA_URI_TAGS,at):pe,le=je(e,"FORBID_CONTENTS")?He({},e.FORBID_CONTENTS,at):de,$=je(e,"FORBID_TAGS")?He({},e.FORBID_TAGS,at):We({}),W=je(e,"FORBID_ATTR")?He({},e.FORBID_ATTR,at):We({}),ce=!!je(e,"USE_PROFILES")&&e.USE_PROFILES,q=!1!==e.ALLOW_ARIA_ATTR,Y=!1!==e.ALLOW_DATA_ATTR,V=e.ALLOW_UNKNOWN_PROTOCOLS||!1,X=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,K=e.SAFE_FOR_TEMPLATES||!1,J=!1!==e.SAFE_FOR_XML,Z=e.WHOLE_DOCUMENT||!1,te=e.RETURN_DOM||!1,ne=e.RETURN_DOM_FRAGMENT||!1,re=e.RETURN_TRUSTED_TYPE||!1,ee=e.FORCE_BODY||!1,ae=!1!==e.SANITIZE_DOM,oe=e.SANITIZE_NAMED_PROPS||!1,se=!1!==e.KEEP_CONTENT,ie=e.IN_PLACE||!1,j=e.ALLOWED_URI_REGEXP||ct,we=e.NAMESPACE||_e,ke=e.MATHML_TEXT_INTEGRATION_POINTS||ke,Fe=e.HTML_INTEGRATION_POINTS||Fe,H=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&it(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(H.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&it(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(H.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(H.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),K&&(Y=!1),ne&&(te=!0),ce&&(B=He({},Ze),F=[],!0===ce.html&&(He(B,qe),He(F,Qe)),!0===ce.svg&&(He(B,Ye),He(F,et),He(F,nt)),!0===ce.svgFilters&&(He(B,Ve),He(F,et),He(F,nt)),!0===ce.mathMl&&(He(B,Ke),He(F,tt),He(F,nt))),e.ADD_TAGS&&("function"==typeof e.ADD_TAGS?G.tagCheck=e.ADD_TAGS:(B===z&&(B=We(B)),He(B,e.ADD_TAGS,at))),e.ADD_ATTR&&("function"==typeof e.ADD_ATTR?G.attributeCheck=e.ADD_ATTR:(F===U&&(F=We(F)),He(F,e.ADD_ATTR,at))),e.ADD_URI_SAFE_ATTR&&He(me,e.ADD_URI_SAFE_ATTR,at),e.FORBID_CONTENTS&&(le===de&&(le=We(le)),He(le,e.FORBID_CONTENTS,at)),se&&(B["#text"]=!0),Z&&He(B,["html","head","body"]),B.table&&(He(B,["tbody"]),delete $.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw ze('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw ze('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');A=e.TRUSTED_TYPES_POLICY,v=A.createHTML("")}else void 0===A&&(A=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let n=null;const r="data-tt-policy-suffix";t&&t.hasAttribute(r)&&(n=t.getAttribute(r));const a="dompurify"+(n?"#"+n:"");try{return e.createPolicy(a,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+a+" could not be created."),null}}(h,o)),null!==A&&"string"==typeof v&&(v=A.createHTML(""));Ae&&Ae(e),ot=e}},dt=He({},[...Ye,...Ve,...Xe]),pt=He({},[...Ke,...Je]),ft=function(e){Ce(n.removed,{element:e});try{b(e).removeChild(e)}catch(t){y(e)}},gt=function(e,t){try{Ce(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){Ce(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(te||ne)try{ft(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},yt=function(e){let t=null,n=null;if(ee)e="<remove></remove>"+e;else{const t=Me(e,/^[\r\n\t ]+/);n=t&&t[0]}"application/xhtml+xml"===$e&&we===_e&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const a=A?A.createHTML(e):e;if(we===_e)try{t=(new m).parseFromString(a,$e)}catch(e){}if(!t||!t.documentElement){t=E.createDocument(we,"template",null);try{t.documentElement.innerHTML=be?v:a}catch(e){}}const o=t.body||t.documentElement;return e&&n&&o.insertBefore(r.createTextNode(n),o.childNodes[0]||null),we===_e?N.call(t,Z?"html":"body")[0]:Z?t.documentElement:o},_t=function(e){return T.call(e.ownerDocument||e,e,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},wt=function(e){return e instanceof p&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof u)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},bt=function(e){return"function"==typeof c&&e instanceof c};function At(e,t,r){Ne(e,e=>{e.call(n,t,r,ot)})}const vt=function(e){let t=null;if(At(x.beforeSanitizeElements,e,null),wt(e))return ft(e),!0;const r=at(e.nodeName);if(At(x.uponSanitizeElement,e,{tagName:r,allowedTags:B}),J&&e.hasChildNodes()&&!bt(e.firstElementChild)&&Be(/<[/\w!]/g,e.innerHTML)&&Be(/<[/\w!]/g,e.textContent))return ft(e),!0;if(7===e.nodeType)return ft(e),!0;if(J&&8===e.nodeType&&Be(/<[/\w]/g,e.data))return ft(e),!0;if(!(G.tagCheck instanceof Function&&G.tagCheck(r))&&(!B[r]||$[r])){if(!$[r]&&Tt(r)){if(H.tagNameCheck instanceof RegExp&&Be(H.tagNameCheck,r))return!1;if(H.tagNameCheck instanceof Function&&H.tagNameCheck(r))return!1}if(se&&!le[r]){const t=b(e)||e.parentNode,n=w(e)||e.childNodes;if(n&&t)for(let r=n.length-1;r>=0;--r){const a=g(n[r],!0);a.__removalCount=(e.__removalCount||0)+1,t.insertBefore(a,_(e))}}return ft(e),!0}return e instanceof l&&!function(e){let t=b(e);t&&t.tagName||(t={namespaceURI:we,tagName:"template"});const n=Ie(e.tagName),r=Ie(t.tagName);return!!ve[e.namespaceURI]&&(e.namespaceURI===ye?t.namespaceURI===_e?"svg"===n:t.namespaceURI===fe?"svg"===n&&("annotation-xml"===r||ke[r]):Boolean(dt[n]):e.namespaceURI===fe?t.namespaceURI===_e?"math"===n:t.namespaceURI===ye?"math"===n&&Fe[r]:Boolean(pt[n]):e.namespaceURI===_e?!(t.namespaceURI===ye&&!Fe[r])&&!(t.namespaceURI===fe&&!ke[r])&&!pt[n]&&(Ue[n]||!dt[n]):!("application/xhtml+xml"!==$e||!ve[e.namespaceURI]))}(e)?(ft(e),!0):"noscript"!==r&&"noembed"!==r&&"noframes"!==r||!Be(/<\/no(script|embed|frames)/i,e.innerHTML)?(K&&3===e.nodeType&&(t=e.textContent,Ne([C,R,I],e=>{t=Le(t,e," ")}),e.textContent!==t&&(Ce(n.removed,{element:e.cloneNode()}),e.textContent=t)),At(x.afterSanitizeElements,e,null),!1):(ft(e),!0)},Et=function(e,t,n){if(ae&&("id"===t||"name"===t)&&(n in r||n in st))return!1;if(Y&&!W[t]&&Be(D,t));else if(q&&Be(M,t));else if(G.attributeCheck instanceof Function&&G.attributeCheck(t,e));else if(!F[t]||W[t]){if(!(Tt(e)&&(H.tagNameCheck instanceof RegExp&&Be(H.tagNameCheck,e)||H.tagNameCheck instanceof Function&&H.tagNameCheck(e))&&(H.attributeNameCheck instanceof RegExp&&Be(H.attributeNameCheck,t)||H.attributeNameCheck instanceof Function&&H.attributeNameCheck(t,e))||"is"===t&&H.allowCustomizedBuiltInElements&&(H.tagNameCheck instanceof RegExp&&Be(H.tagNameCheck,n)||H.tagNameCheck instanceof Function&&H.tagNameCheck(n))))return!1}else if(me[t]);else if(Be(j,Le(n,O,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==Oe(n,"data:")||!ue[e])if(V&&!Be(L,Le(n,O,"")));else if(n)return!1;return!0},Tt=function(e){return"annotation-xml"!==e&&Me(e,P)},kt=function(e){At(x.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||wt(e))return;const r={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:F,forceKeepAttr:void 0};let a=t.length;for(;a--;){const o=t[a],{name:s,namespaceURI:i,value:c}=o,l=at(s),d=c;let u="value"===s?d:Pe(d);if(r.attrName=l,r.attrValue=u,r.keepAttr=!0,r.forceKeepAttr=void 0,At(x.uponSanitizeAttribute,e,r),u=r.attrValue,!oe||"id"!==l&&"name"!==l||(gt(s,e),u="user-content-"+u),J&&Be(/((--!?|])>)|<\/(style|title|textarea)/i,u)){gt(s,e);continue}if("attributename"===l&&Me(u,"href")){gt(s,e);continue}if(r.forceKeepAttr)continue;if(!r.keepAttr){gt(s,e);continue}if(!X&&Be(/\/>/i,u)){gt(s,e);continue}K&&Ne([C,R,I],e=>{u=Le(u,e," ")});const p=at(e.nodeName);if(Et(p,l,u)){if(A&&"object"==typeof h&&"function"==typeof h.getAttributeType)if(i);else switch(h.getAttributeType(p,l)){case"TrustedHTML":u=A.createHTML(u);break;case"TrustedScriptURL":u=A.createScriptURL(u)}if(u!==d)try{i?e.setAttributeNS(i,s,u):e.setAttribute(s,u),wt(e)?ft(e):xe(n.removed)}catch(t){gt(s,e)}}else gt(s,e)}At(x.afterSanitizeAttributes,e,null)},Nt=function e(t){let n=null;const r=_t(t);for(At(x.beforeSanitizeShadowDOM,t,null);n=r.nextNode();)At(x.uponSanitizeShadowNode,n,null),vt(n),kt(n),n.content instanceof s&&e(n.content);At(x.afterSanitizeShadowDOM,t,null)};return n.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=null,o=null,i=null,l=null;if(be=!e,be&&(e="\x3c!--\x3e"),"string"!=typeof e&&!bt(e)){if("function"!=typeof e.toString)throw ze("toString is not a function");if("string"!=typeof(e=e.toString()))throw ze("dirty is not a string, aborting")}if(!n.isSupported)return e;if(Q||lt(t),n.removed=[],"string"==typeof e&&(ie=!1),ie){if(e.nodeName){const t=at(e.nodeName);if(!B[t]||$[t])throw ze("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof c)r=yt("\x3c!----\x3e"),o=r.ownerDocument.importNode(e,!0),1===o.nodeType&&"BODY"===o.nodeName||"HTML"===o.nodeName?r=o:r.appendChild(o);else{if(!te&&!K&&!Z&&-1===e.indexOf("<"))return A&&re?A.createHTML(e):e;if(r=yt(e),!r)return te?null:re?v:""}r&&ee&&ft(r.firstChild);const d=_t(ie?e:r);for(;i=d.nextNode();)vt(i),kt(i),i.content instanceof s&&Nt(i.content);if(ie)return e;if(te){if(ne)for(l=k.call(r.ownerDocument);r.firstChild;)l.appendChild(r.firstChild);else l=r;return(F.shadowroot||F.shadowrootmode)&&(l=S.call(a,l,!0)),l}let u=Z?r.outerHTML:r.innerHTML;return Z&&B["!doctype"]&&r.ownerDocument&&r.ownerDocument.doctype&&r.ownerDocument.doctype.name&&Be(ut,r.ownerDocument.doctype.name)&&(u="<!DOCTYPE "+r.ownerDocument.doctype.name+">\n"+u),K&&Ne([C,R,I],e=>{u=Le(u,e," ")}),A&&re?A.createHTML(u):u},n.setConfig=function(){lt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Q=!0},n.clearConfig=function(){ot=null,Q=!1},n.isValidAttribute=function(e,t,n){ot||lt({});const r=at(e),a=at(t);return Et(r,a,n)},n.addHook=function(e,t){"function"==typeof t&&Ce(x[e],t)},n.removeHook=function(e,t){if(void 0!==t){const n=Se(x[e],t);return-1===n?void 0:Re(x[e],n,1)[0]}return xe(x[e])},n.removeHooks=function(e){x[e]=[]},n.removeAllHooks=function(){x={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},n}();const gt=e=>/<[a-z][\s\S]*>/i.test(e),yt=({width:e=32,height:t=32})=>{const n=(0,i.useSelect)(e=>{const{getCurrentUser:t}=e("core");return t()},[]),r=()=>n&&(n.avatar_urls?.[96]||n.avatar_urls?.[48])||null;return(0,ie.jsx)("div",{className:"nfd-editor-chat-message__avatar nfd-editor-chat-message__avatar--user",style:{width:e,height:t},children:r()?(0,ie.jsx)("img",{src:r(),alt:"User avatar",className:"nfd-editor-chat-message__avatar-image"}):(0,ie.jsx)("span",{children:n&&(n.name||n.display_name||n.user_login||"").charAt(0).toUpperCase()||"U"})})},_t=({message:e,type:t="assistant"})=>{const n="user"===t,r=(0,l.useMemo)(()=>e?n?e:gt(e)?(e=>ft.sanitize(e,{ALLOWED_TAGS:["section","div","h1","h2","h3","h4","h5","h6","p","span","strong","em","b","i","u","s","mark","small","sub","sup","a","br","ul","ol","li","dl","dt","dd","blockquote","code","pre","table","thead","tbody","tr","th","td","hr","address","time"],ALLOWED_ATTR:["style","class","id","href","datetime"],ALLOW_DATA_ATTR:!1,FORBID_TAGS:["script","object","embed","iframe","form","fieldset","legend","label","input","textarea","select","option","button","details","summary","progress","meter"],FORBID_ATTR:["onerror","onload","onclick","onmouseover","onfocus","onblur"]}))(e):e:"",[e,n]),a=!n&&gt(e);return(0,ie.jsxs)("div",{className:`nfd-editor-chat-message nfd-editor-chat-message--${t}`,children:[a?(0,ie.jsx)("div",{className:"nfd-editor-chat-message__content",dangerouslySetInnerHTML:{__html:r}}):(0,ie.jsx)("div",{className:"nfd-editor-chat-message__content",children:r}),n&&(0,ie.jsx)(yt,{width:32,height:32})]})},wt=({messages:e=[],isLoading:t=!1,error:n=null,status:r=null})=>{const a=(0,l.useRef)(null);return(0,l.useEffect)(()=>{a.current?.scrollIntoView({behavior:"smooth"})},[e,t]),(0,ie.jsxs)("div",{className:"nfd-editor-chat-messages",children:[e.length&&e.map((e,t)=>(0,ie.jsx)(_t,{message:e.content,type:e.type},t)),n&&(0,ie.jsx)(he,{message:n}),t&&(0,ie.jsx)(fe,{status:r}),(0,ie.jsx)("div",{ref:a})]})};var bt;function At(){return At=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},At.apply(null,arguments)}ae("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]),ae("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),ae("FilePlus",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]]),ae("Layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]);var vt=function(e){return ee.createElement("svg",At({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,baseProfile:"basic",viewBox:"0 0 30 30"},e),bt||(bt=ee.createElement("path",{d:"m14.217 19.707-1.112 2.547a1.199 1.199 0 0 1-2.21 0l-1.112-2.547A9.8 9.8 0 0 0 4.79 14.65l-3.06-1.358c-.973-.432-.973-1.848 0-2.28l2.965-1.316C6.974 8.684 8.787 6.813 9.76 4.47l1.126-2.714a1.2 1.2 0 0 1 2.228 0L14.24 4.47c.973 2.344 2.786 4.215 5.065 5.226l2.965 1.316c.973.432.973 1.848 0 2.28l-3.061 1.359a9.8 9.8 0 0 0-4.992 5.056M24.481 27.796l-.339.777a.696.696 0 0 1-1.284 0l-.339-.777a6 6 0 0 0-3.051-3.092l-1.044-.464c-.565-.251-.565-1.072 0-1.323l.986-.438a6 6 0 0 0 3.095-3.195l.348-.84a.696.696 0 0 1 1.294 0l.348.84a6 6 0 0 0 3.095 3.195l.986.438c.565.251.565 1.072 0 1.323l-1.044.464a6 6 0 0 0-3.051 3.092"})))};const Et=({width:e=24,height:t=24})=>(0,ie.jsx)("div",{className:"nfd-editor-chat-ai-avatar",style:{width:e,height:t},children:(0,ie.jsx)(vt,{width:.625*e,height:.625*t})}),Tt=({onSendMessage:e})=>((0,d.__)("Add a new section","wp-module-editor-chat"),(0,d.__)("Update color scheme","wp-module-editor-chat"),(0,d.__)("Create new page","wp-module-editor-chat"),(0,d.__)("Edit content","wp-module-editor-chat"),(0,ie.jsxs)("div",{className:"nfd-editor-chat-welcome",children:[(0,ie.jsxs)("div",{className:"nfd-editor-chat-welcome__content",children:[(0,ie.jsx)("div",{className:"nfd-editor-chat-welcome__avatar",children:(0,ie.jsx)(Et,{width:48,height:48})}),(0,ie.jsxs)("div",{className:"nfd-editor-chat-welcome__message",children:[(0,ie.jsx)("div",{className:"nfd-editor-chat-welcome__title",children:(0,d.__)("Hi, I'm BLU, your AI assistant.","wp-module-editor-chat")}),(0,ie.jsx)("div",{className:"nfd-editor-chat-welcome__subtitle",children:(0,d.__)("I can help you update page sections and styles,","wp-module-editor-chat")}),(0,ie.jsx)("div",{className:"nfd-editor-chat-welcome__subtitle",children:(0,d.__)("add, remove, or edit existing content.","wp-module-editor-chat")})]})]}),(0,ie.jsx)("div",{className:"nfd-editor-chat-suggestions",children:!1})]})),kt=ae("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Nt=({onNewChat:e})=>(0,ie.jsxs)("div",{className:"nfd-editor-chat-sidebar__header-content",children:[(0,ie.jsxs)("h2",{className:"interface-complementary-area-header__title",children:[(0,d.__)("AI Chat Editor","wp-module-editor-chat"),(0,ie.jsx)("span",{className:"nfd-editor-chat-sidebar__beta-badge",children:"Beta"})]}),e&&(0,ie.jsx)("div",{className:"nfd-editor-chat-sidebar__header-actions",children:(0,ie.jsx)(Q.Button,{icon:(0,ie.jsx)(kt,{width:16,height:16}),label:(0,d.__)("New chat","wp-module-editor-chat"),onClick:e,className:"nfd-editor-chat-sidebar__new-chat"})})]}),St="nfd-editor-chat",xt="core",Ct=()=>{const{enableComplementaryArea:e}=(0,i.useDispatch)(D),{messages:t,isLoading:n,error:r,status:a,isSaving:o,handleSendMessage:s,handleNewChat:u,handleAcceptChanges:p,handleDeclineChanges:m}=Z();(0,l.useEffect)(()=>{e(xt,St)},[e]);const h=t.filter(e=>e.hasActions).length,f=h>0;return(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(c.PluginSidebarMoreMenuItem,{scope:xt,target:St,icon:(0,ie.jsx)(Et,{width:24,height:24}),children:(0,d.__)("AI Chat Editor","wp-module-editor-chat")}),(0,ie.jsx)(c.PluginSidebar,{scope:xt,identifier:St,className:"nfd-editor-chat-sidebar",closeLabel:(0,d.__)("Close AI Chat Editor","wp-module-editor-chat"),icon:(0,ie.jsx)(Et,{width:24,height:24}),headerClassName:"nfd-editor-chat-sidebar__header",panelClassName:"nfd-editor-chat-sidebar__panel",header:(0,ie.jsx)(Nt,{onNewChat:u}),children:(0,ie.jsxs)("div",{className:"nfd-editor-chat-sidebar__content",children:[0===t.length?(0,ie.jsx)(Tt,{onSendMessage:s}):(0,ie.jsx)(wt,{messages:t,isLoading:n,error:r,status:a}),f&&(0,ie.jsx)(ce,{pendingCount:h,onAccept:p,onDecline:m,isSaving:o}),(0,ie.jsx)(pe,{onSendMessage:s,disabled:n})]})})]})};o()(()=>{(0,s.registerPlugin)("nfd-editor-chat",{render:Ct})}),((((window.newfold=window.newfold||{}).wordpress=window.newfold.wordpress||{}).editor=window.newfold.wordpress.editor||{}).chat=window.newfold.wordpress.editor.chat||{})["chat-editor"]=t})();