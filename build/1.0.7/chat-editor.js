(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{ChatEditor:()=>Rt});var n={};e.r(n),e.d(n,{closeModal:()=>v,disableComplementaryArea:()=>w,enableComplementaryArea:()=>y,openModal:()=>S,pinItem:()=>b,setDefaultComplementaryArea:()=>g,setFeatureDefaults:()=>E,setFeatureValue:()=>A,toggleFeature:()=>k,unpinItem:()=>_});var r={};e.r(r),e.d(r,{getActiveComplementaryArea:()=>T,isComplementaryAreaLoading:()=>N,isFeatureActive:()=>I,isItemPinned:()=>x,isModalActive:()=>C});const o=window.wp.domReady;var a=e.n(o);const s=window.wp.plugins,i=window.wp.data,c=window.wp.editor,l=window.wp.element,d=window.wp.i18n,u=window.wp.deprecated;var p=e.n(u);const m=window.wp.preferences;function h(e){return["core/edit-post","core/edit-site"].includes(e)?(p()(`${e} interface scope`,{alternative:"core interface scope",hint:"core/edit-post and core/edit-site are merging.",version:"6.6"}),"core"):e}function f(e,t){return"core"===e&&"edit-site/template"===t?(p()("edit-site/template sidebar",{alternative:"edit-post/document",version:"6.6"}),"edit-post/document"):"core"===e&&"edit-site/block-inspector"===t?(p()("edit-site/block-inspector sidebar",{alternative:"edit-post/block",version:"6.6"}),"edit-post/block"):t}const g=(e,t)=>({type:"SET_DEFAULT_COMPLEMENTARY_AREA",scope:e=h(e),area:t=f(e,t)}),y=(e,t)=>({registry:n,dispatch:r})=>{t&&(e=h(e),t=f(e,t),n.select(m.store).get(e,"isComplementaryAreaVisible")||n.dispatch(m.store).set(e,"isComplementaryAreaVisible",!0),r({type:"ENABLE_COMPLEMENTARY_AREA",scope:e,area:t}))},w=e=>({registry:t})=>{e=h(e),t.select(m.store).get(e,"isComplementaryAreaVisible")&&t.dispatch(m.store).set(e,"isComplementaryAreaVisible",!1)},b=(e,t)=>({registry:n})=>{if(!t)return;e=h(e),t=f(e,t);const r=n.select(m.store).get(e,"pinnedItems");!0!==r?.[t]&&n.dispatch(m.store).set(e,"pinnedItems",{...r,[t]:!0})},_=(e,t)=>({registry:n})=>{if(!t)return;e=h(e),t=f(e,t);const r=n.select(m.store).get(e,"pinnedItems");n.dispatch(m.store).set(e,"pinnedItems",{...r,[t]:!1})};function k(e,t){return function({registry:n}){p()("dispatch( 'core/interface' ).toggleFeature",{since:"6.0",alternative:"dispatch( 'core/preferences' ).toggle"}),n.dispatch(m.store).toggle(e,t)}}function A(e,t,n){return function({registry:r}){p()("dispatch( 'core/interface' ).setFeatureValue",{since:"6.0",alternative:"dispatch( 'core/preferences' ).set"}),r.dispatch(m.store).set(e,t,!!n)}}function E(e,t){return function({registry:n}){p()("dispatch( 'core/interface' ).setFeatureDefaults",{since:"6.0",alternative:"dispatch( 'core/preferences' ).setDefaults"}),n.dispatch(m.store).setDefaults(e,t)}}function S(e){return{type:"OPEN_MODAL",name:e}}function v(){return{type:"CLOSE_MODAL"}}const T=(0,i.createRegistrySelector)(e=>(t,n)=>{n=h(n);const r=e(m.store).get(n,"isComplementaryAreaVisible");if(void 0!==r)return!1===r?null:t?.complementaryAreas?.[n]}),N=(0,i.createRegistrySelector)(e=>(t,n)=>{n=h(n);const r=e(m.store).get(n,"isComplementaryAreaVisible"),o=t?.complementaryAreas?.[n];return r&&void 0===o}),x=(0,i.createRegistrySelector)(e=>(t,n,r)=>{var o;r=f(n=h(n),r);const a=e(m.store).get(n,"pinnedItems");return null===(o=a?.[r])||void 0===o||o}),I=(0,i.createRegistrySelector)(e=>(t,n,r)=>(p()("select( 'core/interface' ).isFeatureActive( scope, featureName )",{since:"6.0",alternative:"select( 'core/preferences' ).get( scope, featureName )"}),!!e(m.store).get(n,r)));function C(e,t){return e.activeModal===t}const R=(0,i.combineReducers)({complementaryAreas:function(e={},t){switch(t.type){case"SET_DEFAULT_COMPLEMENTARY_AREA":{const{scope:n,area:r}=t;return e[n]?e:{...e,[n]:r}}case"ENABLE_COMPLEMENTARY_AREA":{const{scope:n,area:r}=t;return{...e,[n]:r}}}return e},activeModal:function(e=null,t){switch(t.type){case"OPEN_MODAL":return t.name;case"CLOSE_MODAL":return null}return e}}),D=(0,i.createReduxStore)("core/interface",{reducer:R,actions:n,selectors:r});(0,i.register)(D);const M=window.wp.coreData,O=window.wp.apiFetch;var L=e.n(O);const B=window.wp.blocks,P=async()=>{const e=j(),t=F();return{page_content:e,...await H(t)}},j=()=>{const e=(0,i.select)("core/block-editor"),t=e.getBlocks(),n=t.find(e=>"core/post-content"===e.name);return n?e.getBlocks(n.clientId).map(e=>({clientId:e.clientId,content:(0,B.serialize)(e)})):t.map(e=>({clientId:e.clientId,content:(0,B.serialize)(e)}))},F=()=>(0,i.select)("core/block-editor").getBlocks().filter(e=>"core/template-part"===e.name),z=async(e,t=null)=>{if(!e||!e.attributes)return"";const{ref:n,slug:r,theme:o}=e.attributes,a=t||(0,i.resolveSelect)("core");if(n){const e=await a.getEntityRecord("postType","wp_template_part",n);return e&&e.content&&(e.content.raw||e.content.rendered)||""}if(r&&o){const e=`${o}//${r}`,t=await a.getEntityRecord("postType","wp_template_part",e);if(t&&t.content)return t.content.raw||t.content.rendered||""}if(r){const e=o?{slug:[r],theme:o}:{slug:[r]},t=await a.getEntityRecords("postType","wp_template_part",e);if(Array.isArray(t)&&t.length>0){const e=t.find(e=>e&&e.slug===r&&(!o||e.theme===o))||t[0];return e&&e.content&&(e.content.raw||e.content.rendered)||""}}return""},U=(e,t)=>e.slug||(e.ref?String(e.ref):null)||e.area||`template_part_${t}`,H=async e=>{const t=(0,i.resolveSelect)("core"),n={};for(let r=0;r<e.length;r++){const o=e[r],a=o.attributes||{},s=await z(o,t),i=U(a,r);i&&!n[i]&&(n[i]={clientId:o.clientId,content:s})}return n},$=()=>(0,i.select)("core/block-editor").getSelectedBlock()||null,G=e=>e&&"core/template-part"===e.name,W=async e=>{if(!e||!e.attributes)return null;const{ref:t,slug:n,theme:r}=e.attributes,o=(0,i.resolveSelect)("core");if(t)return await o.getEntityRecord("postType","wp_template_part",t);if(n&&r){const e=`${r}//${n}`,t=await o.getEntityRecord("postType","wp_template_part",e);if(t)return t}if(n){const e=r?{slug:[n],theme:r}:{slug:[n]},t=await o.getEntityRecords("postType","wp_template_part",e);if(Array.isArray(t)&&t.length>0)return t.find(e=>e&&e.slug===n&&(!r||e.theme===r))||t[0]}return null},q=async(e,t)=>{try{const n=await(async e=>{if(e?.attributes?.ref)return e.attributes.ref;const t=await W(e);return t?.id||null})(e);if(!n)throw new Error("Could not resolve template part entity ID");const r=t.map(e=>(0,B.serialize)(e)).join(""),o=(0,i.dispatch)("core");return await o.editEntityRecord("postType","wp_template_part",n,{content:r}),{success:!0,message:"Template part updated successfully",entityId:n,savedRecord:await o.saveEditedEntityRecord("postType","wp_template_part",n)}}catch(e){return console.error("Error updating template part:",e),{success:!1,message:`Failed to update template part: ${e.message}`,error:e}}},Y=async()=>{const e=$();let t=null;if(e){const{clientId:n,...r}=e;t={...r,originalContent:(0,B.serialize)(e)}}return{page:{page_id:(0,i.select)("core/editor").getCurrentPostId(),page_title:(0,i.select)("core/editor").getEditedPostAttribute("title")||"",selected_block:t,content:await P()}}},V=async()=>{try{return await L()({path:"/nfd-editor-chat/v1/chat/new",method:"POST"})}catch(e){throw console.error("Error creating new conversation:",e),e}},X=new class{async executeActions(e){if(!e||!Array.isArray(e))return{success:!0,message:"No actions to execute"};const t=[],n=[];for(const r of e)try{if(!r.action){n.push("Action missing 'action' property");continue}const e=await this.executeAction(r);t.push(e)}catch(e){n.push(e.message),console.error("Action failed:",e)}return{success:0===n.length,message:0===n.length?"All actions executed successfully":"Some actions failed",results:t,errors:n}}async executeAction(e){if("edit_content"===e.action)return this.handleEditContentAction(e);if("change_site_colors"===e.action)return this.handleChangeSiteColorsAction(e);throw new Error(`Unsupported action type: ${e.action}`)}async handleEditContentAction(e){const{data:t}=e;if(!t)throw new Error("Edit content action requires data object");const n=t.operation_type;if(!n)throw new Error("Edit content action requires data.operation_type");const r=[],o=[];try{let e;if("edit"===n){const n=t.section;if(!n)throw new Error("Edit action requires section");const o=t.block_content;if(!o)throw new Error("Edit action requires block_content");e=await this.handleRewriteAction(n,o),r.push(e)}else if("delete"===n){const n=t.section;if(!n)throw new Error("Delete action requires section");e=await this.handleDeleteAction(n),r.push(e)}else{if("add"!==n)throw new Error(`Unsupported operation_type: ${n}`);{const n=t.location,o=t.block_content;if(!o)throw new Error("Add action requires block_content");e=await this.handleAddAction(n||null,[{block_content:o}]),r.push(e)}}}catch(e){o.push(`Failed to execute ${n} action: ${e.message}`),console.error(`Failed to execute ${n} action:`,e)}return{type:"edit_content",success:0===o.length,message:0===o.length?"All content changes applied successfully":"Some content changes failed",results:r,errors:o}}async handlePatchAction(e,t){return this.applyContentChanges(e,t)}async handleRewriteAction(e,t){const{getBlock:n}=(0,i.select)("core/block-editor"),r=n(e);if(!r)throw new Error(`Block with clientId ${e} not found`);if(G(r))return this.applyTemplatePartRewrite(e,r,t);const o={clientId:e,name:r.name,attributes:{...r.attributes},innerBlocks:r.innerBlocks?[...r.innerBlocks]:[]},a=(0,B.parse)(t);if(!a||0===a.length)throw new Error("Failed to parse block_content into blocks");const s=a[0];if(!s)throw new Error("Failed to parse updated block");const{updateBlockAttributes:c,replaceInnerBlocks:l}=(0,i.dispatch)("core/block-editor");return s.attributes&&c(e,s.attributes),s.innerBlocks&&s.innerBlocks.length>0?l(e,s.innerBlocks.map(e=>this.createBlockFromParsed(e))):r.innerBlocks&&r.innerBlocks.length>0&&l(e,[]),{clientId:e,blockName:r.name,message:`Block ${r.name} content rewritten successfully`,originalBlock:o}}async applyContentChanges(e,t){const{getBlock:n}=(0,i.select)("core/block-editor"),r=n(e);if(!r)throw new Error(`Block with clientId ${e} not found`);if(G(r))return this.applyTemplatePartChanges(e,r,t);const o={clientId:e,name:r.name,attributes:{...r.attributes},innerBlocks:r.innerBlocks?[...r.innerBlocks]:[]};let a=(0,B.serialize)(r);for(const n of t){const{find:t,replace:r}=n;if("string"!=typeof t||"string"!=typeof r)throw new Error("Change must have find and replace as strings");const o=this.normalizeHtml(a),s=this.normalizeHtml(t),i=this.normalizeHtml(r);o.includes(s)?a=o.replace(s,i):console.warn(`Find string not found in block ${e}:`,t.substring(0,50))}const s=(0,B.parse)(a);if(!s||0===s.length)throw new Error("Failed to parse updated content into blocks");const c=s[0];if(!c)throw new Error("Failed to parse updated block");const{updateBlockAttributes:l,replaceInnerBlocks:d}=(0,i.dispatch)("core/block-editor");return c.attributes&&l(e,c.attributes),c.innerBlocks&&c.innerBlocks.length>0?d(e,c.innerBlocks.map(e=>this.createBlockFromParsed(e))):r.innerBlocks&&r.innerBlocks.length>0&&d(e,[]),{clientId:e,blockName:r.name,changesApplied:t.length,message:`Block ${r.name} content updated successfully`,originalBlock:o}}async applyTemplatePartRewrite(e,t,n){const r=await W(t),o={clientId:e,name:t.name,attributes:{...t.attributes},innerBlocks:t.innerBlocks?[...t.innerBlocks]:[],isTemplatePart:!0,entityContent:r?r.content:null},a=(0,B.parse)(n);if(!a||0===a.length)throw new Error("Failed to parse block_content into blocks");const{replaceInnerBlocks:s}=(0,i.dispatch)("core/block-editor");s(e,a.map(e=>this.createBlockFromParsed(e)));const c=await q(t,a);return c.success||console.warn("Template part entity update failed:",c.message),{clientId:e,blockName:t.name,message:"Template part content rewritten successfully",originalBlock:o,isTemplatePart:!0,entityUpdateResult:c}}async applyTemplatePartChanges(e,t,n){const r=(0,i.resolveSelect)("core"),o=await W(t),a={clientId:e,name:t.name,attributes:{...t.attributes},innerBlocks:t.innerBlocks?[...t.innerBlocks]:[],isTemplatePart:!0,entityContent:o?o.content:null},s=await z(t,r);if(!s)throw new Error("Template part has no content to modify");let c=s,l=0;for(const e of n){const{find:t,replace:n}=e;if("string"!=typeof t||"string"!=typeof n)throw new Error("Change must have find and replace as strings");const r=this.normalizeHtml(c),o=this.normalizeHtml(t),a=this.normalizeHtml(n);r.includes(o)&&(c=r.replace(o,a),l++)}if(0===l)return{clientId:e,blockName:t.name,changesApplied:0,message:"No matching content found in template part",originalBlock:a,isTemplatePart:!0};const d=(0,B.parse)(c);if(!d||0===d.length)throw new Error("Failed to parse updated template part content into blocks");const{replaceInnerBlocks:u}=(0,i.dispatch)("core/block-editor"),p=d.map(e=>this.createBlockFromParsed(e));u(e,p);const m=await q(t,p);return m.success||console.warn("Template part entity update failed:",m.message),{clientId:e,blockName:t.name,changesApplied:l,message:"Template part content updated successfully",originalBlock:a,isTemplatePart:!0,entityUpdateResult:m}}async restoreBlocks(e){if(!e||!Array.isArray(e))return{success:!1,message:"No undo data available"};const{updateBlockAttributes:t,replaceInnerBlocks:n}=(0,i.dispatch)("core/block-editor"),{getBlock:r}=(0,i.select)("core/block-editor"),o=[],a=[];for(const s of e)try{const{clientId:e,attributes:i,innerBlocks:c,isTemplatePart:l,entityContent:d}=s;if(!e){a.push("Missing clientId in undo data");continue}if(l&&d){const t=r(e);if(t){const r="string"==typeof d?d:d.raw||d.rendered;if(r){const o=(0,B.parse)(r),s=await q(t,o);s.success||(console.warn("Failed to restore template part entity:",s.message),a.push(`Template part entity restore failed: ${s.message}`)),n(e,o.map(e=>this.createBlockFromParsed(e)))}else console.error("No content string to restore for template part")}else console.error("Could not find block with clientId:",e)}else t(e,i),c&&Array.isArray(c)&&n(e,c.map(e=>this.createBlockFromParsed(e)));const u=l?"Template part":"Block";o.push({clientId:e,message:`${u} restored successfully`})}catch(e){a.push(`Failed to restore block: ${e.message}`),console.error("Failed to restore block:",e)}return{success:0===a.length,message:0===a.length?"All blocks restored successfully":"Some blocks failed to restore",results:o,errors:a}}normalizeHtml(e){return e.replace(/\s+/g," ").replace(/>\s+</g,"><").replace(/\\\//g,"/").trim()}async handleDeleteAction(e){const{getBlock:t}=(0,i.select)("core/block-editor"),n=t(e);if(!n)throw new Error(`Block with clientId ${e} not found`);if(G(n))return this.handleDeleteTemplatePart(e,n);const r={clientId:e,name:n.name,attributes:{...n.attributes},innerBlocks:n.innerBlocks?[...n.innerBlocks]:[]},{removeBlock:o}=(0,i.dispatch)("core/block-editor");return o(e),{clientId:e,blockName:n.name,message:`Block ${n.name} deleted successfully`,originalBlock:r}}async handleDeleteTemplatePart(e,t){const n=await W(t),r={clientId:e,name:t.name,attributes:{...t.attributes},innerBlocks:t.innerBlocks?[...t.innerBlocks]:[],isTemplatePart:!0,entityContent:n?n.content:null},{removeBlock:o}=(0,i.dispatch)("core/block-editor");return o(e),{clientId:e,blockName:t.name,message:"Template part deleted successfully",originalBlock:r,isTemplatePart:!0}}getEffectiveRootBlocks(){const{getBlocks:e}=(0,i.select)("core/block-editor"),t=e(),n=t.find(e=>"core/post-content"===e.name);if(n){const t=e(n.clientId);if(t.length>0)return{blocks:t,parentClientId:n.clientId}}return{blocks:t,parentClientId:null}}findBlockContext(e){const{getBlocks:t}=(0,i.select)("core/block-editor"),n=t(),r=n.findIndex(t=>t.clientId===e);if(-1!==r)return{blocks:n,parentClientId:null,index:r};const o=n.find(e=>"core/post-content"===e.name);if(o){const n=t(o.clientId),r=n.findIndex(t=>t.clientId===e);if(-1!==r)return{blocks:n,parentClientId:o.clientId,index:r}}return null}async handleAddAction(e,t){const{getBlocks:n,getBlock:r}=(0,i.select)("core/block-editor"),{insertBlocks:o}=(0,i.dispatch)("core/block-editor"),a=[],s=[];for(const e of t)if(e.block_content&&"string"==typeof e.block_content)try{const t=(0,B.parse)(e.block_content);if(!t||0===t.length){a.push("Failed to parse block_content into blocks");continue}const n=t.map(e=>this.createBlockFromParsed(e));s.push(...n)}catch(e){a.push(`Failed to parse block_content: ${e.message}`),console.error("Failed to parse block_content:",e)}else a.push("Add action change missing block_content string");if(0===s.length)throw new Error("No valid blocks to insert");if(null===e){const e=this.getEffectiveRootBlocks();if(e.blocks.length>0)e.parentClientId?o(s,0,e.parentClientId):o(s,0,e.blocks[0].clientId);else{const e=n().find(e=>"core/post-content"===e.name);e?o(s,0,e.clientId):o(s,0)}}else{if(!r(e))throw new Error(`Target block with clientId ${e} not found`);const t=this.findBlockContext(e);if(!t)throw new Error(`Target block ${e} not found in root blocks or post-content`);const n=t.index+1;t.parentClientId?o(s,n,t.parentClientId):n<t.blocks.length?o(s,n,t.blocks[n].clientId):o(s,n)}const c=s.map(e=>e.clientId||null).filter(Boolean);return{clientId:e||"root",blocksAdded:s.length,insertedClientIds:c,message:`Added ${s.length} block(s) successfully`,errors:a.length>0?a:void 0}}createBlockFromParsed(e){const t=e.innerBlocks?e.innerBlocks.map(e=>this.createBlockFromParsed(e)):[];return(0,B.createBlock)(e.name,e.attributes||{},t)}async handleChangeSiteColorsAction(e){const{data:t}=e;if(!t||!t.colors||!Array.isArray(t.colors))throw new Error("Change site colors action requires data.colors array");const{__experimentalGetCurrentGlobalStylesId:n,getEditedEntityRecord:r}=(0,i.select)(M.store),o=n?n():void 0;if(!o)throw new Error("Global styles not found. Please ensure you have permission to edit global styles.");const a=r("root","globalStyles",o);if(!a||!a.settings)throw new Error("Unable to access global styles settings.");const s=a.settings,c=s?.color?.palette?.theme,l=c||[],d=JSON.parse(JSON.stringify(s));let u=l;for(const e of t.colors){const{slug:t,color:n}=e;t&&n?u=u.map(e=>e.slug===t?{...e,color:n}:e):console.warn("Invalid color update:",e)}const{editEntityRecord:p}=(0,i.dispatch)(M.store);return p("root","globalStyles",o,{settings:{...s||{},color:{palette:{...s?.color?.palette||{},theme:u}}}}),{type:"change_site_colors",success:!0,message:"Site colors updated successfully",colorsUpdated:t.colors.length,originalStyles:d,globalStylesId:o}}async restoreGlobalStyles(e){if(!e||!e.originalStyles||!e.globalStylesId)return{success:!1,message:"No undo data available for global styles"};const{originalStyles:t,globalStylesId:n}=e,{editEntityRecord:r}=(0,i.dispatch)(M.store);try{return r("root","globalStyles",n,{settings:t}),{success:!0,message:"Global styles restored successfully"}}catch(e){return console.error("Failed to restore global styles:",e),{success:!1,message:`Failed to restore global styles: ${e.message}`}}}},K=X,J=()=>{const e=(e=>{if(!e||"string"!=typeof e)return"0";let t=5381;for(let n=0;n<e.length;n++)t=(t<<5)+t+e.charCodeAt(n),t|=0;return(t>>>0).toString(16)})(window.location.origin);return{CONVERSATION_ID:`nfd-editor-chat-conversation-id-${e}`,MESSAGES:`nfd-editor-chat-messages-${e}`}},Z=()=>{try{const e=J();return localStorage.getItem(e.CONVERSATION_ID)}catch(e){return console.warn("Failed to load conversation ID from localStorage:",e),null}},Q=()=>{const e=Z(),t=(()=>{try{const e=J(),t=localStorage.getItem(e.MESSAGES);return t?JSON.parse(t).map(e=>{const{hasActions:t,undoData:n,...r}=e;return r}):[]}catch(e){return console.warn("Failed to load messages from localStorage:",e),[]}})(),[n,r]=(0,l.useState)(t||[]),[o,a]=(0,l.useState)(!1),[s,c]=(0,l.useState)(e),[u,p]=(0,l.useState)(null),[m,h]=(0,l.useState)(null),[f,g]=(0,l.useState)(!1),[y,w]=(0,l.useState)(!1),b=(0,l.useRef)(!1),_=(0,l.useRef)(null),k=(0,l.useRef)(null),A=(0,l.useRef)(null),{savePost:E}=(0,i.useDispatch)("core/editor"),{saveEditedEntityRecord:S}=(0,i.useDispatch)(M.store),{__experimentalGetCurrentGlobalStylesId:v}=(0,i.useSelect)(e=>({__experimentalGetCurrentGlobalStylesId:e(M.store).__experimentalGetCurrentGlobalStylesId}),[]),T=(0,i.useSelect)(e=>e("core/editor").isSavingPost(),[]);(0,l.useEffect)(()=>{f&&!T&&(r(e=>e.map(e=>{if(e.hasActions){const{hasActions:t,undoData:n,...r}=e;return r}return e})),w(!1),g(!1))},[f,T]),(0,l.useEffect)(()=>{b.current||(b.current=!0,Z()||(async()=>{try{const e=await V();e.conversationId&&c(e.conversationId)}catch(e){console.error("Failed to initialize conversation:",e)}})())},[]),(0,l.useEffect)(()=>{(e=>{try{const t=J();e?localStorage.setItem(t.CONVERSATION_ID,e):localStorage.removeItem(t.CONVERSATION_ID)}catch(e){console.warn("Failed to save conversation ID to localStorage:",e)}})(s)},[s]),(0,l.useEffect)(()=>{n.length>0&&(e=>{try{const t=J();localStorage.setItem(t.MESSAGES,JSON.stringify(e))}catch(e){console.warn("Failed to save messages to localStorage:",e)}})(n)},[n]),(0,l.useEffect)(()=>()=>{_.current&&(clearInterval(_.current),_.current=null),k.current&&(clearTimeout(k.current),k.current=null)},[]);const N=()=>{_.current&&(clearInterval(_.current),_.current=null),k.current&&(clearTimeout(k.current),k.current=null),A.current=null};return{messages:n,isLoading:o,conversationId:s,error:u,status:m,isSaving:f,handleSendMessage:async e=>{if(p(null),h(null),!s)return void p((0,d.__)("No active conversation. Please refresh the page and try again.","wp-module-editor-chat"));const t={type:"user",content:e};r(e=>[...e,t]),a(!0),h("received");try{const t=await(async(e,t)=>{try{const n={message:t,context:await Y(),conversationId:e};return await L()({path:"/nfd-editor-chat/v1/chat",method:"POST",data:n})}catch(e){throw console.error("Error sending message:",e),e}})(s,e);if(!t.message_id)throw console.error("No message_id in response:",t),new Error("No message_id received from API");const o=t.message_id;setTimeout(()=>{(e=>{N(),A.current=Date.now();const t=12e4,o=async()=>{try{if(Date.now()-A.current>=t)return N(),p((0,d.__)("The request is taking longer than expected. Please try again or refresh the page.","wp-module-editor-chat")),a(!1),void h(null);const o=await(async e=>{try{return await L()({path:"/nfd-editor-chat/v1/chat/status",method:"POST",data:{message_id:e}})}catch(e){throw console.error("Error checking status:",e),e}})(e),s=o.status;if(h(s),"completed"===s){if(N(),o.data){const e=o.data;let t="I received your message.";e.chat?.current_message?.assistant&&(t=e.chat.current_message.assistant);let a=!1,s=null;if(e.actions&&Array.isArray(e.actions)&&e.actions.length>0)try{if(n.some(e=>e.hasActions)){const t=n.find(e=>e.hasActions&&e.undoData);s=t&&t.undoData?Array.isArray(t.undoData)?{blocks:t.undoData,globalStyles:null}:t.undoData:null,await K.executeActions(e.actions),a=!0,e.actions.some(e=>"change_site_colors"===e.action)&&w(!0)}else{const t=await K.executeActions(e.actions);a=!0,e.actions.some(e=>"change_site_colors"===e.action)&&w(!0),s={blocks:[],globalStyles:null},t.results&&t.results.length>0&&t.results.forEach(e=>{e.results&&Array.isArray(e.results)&&e.results.forEach(e=>{e.originalBlock&&s.blocks.push(e.originalBlock)}),"change_site_colors"===e.type&&e.originalStyles&&e.globalStylesId&&(s.globalStyles={originalStyles:e.originalStyles,globalStylesId:e.globalStylesId})})}}catch(e){console.error("Error executing actions:",e)}const i={type:"assistant",content:t,hasActions:a,undoData:s};r(e=>[...e,i])}a(!1),h(null)}else"failed"===s&&(N(),p((0,d.__)("Sorry, I encountered an error processing your request. Please try again.","wp-module-editor-chat")),a(!1),h(null))}catch(e){console.error("Error checking status:",e),Date.now()-A.current>=t&&(N(),p((0,d.__)("The request is taking longer than expected. Please try again or refresh the page.","wp-module-editor-chat")),a(!1),h(null))}};o(),_.current=setInterval(o,4e3),k.current=setTimeout(()=>{N(),p((0,d.__)("The request is taking longer than expected. Please try again or refresh the page.","wp-module-editor-chat")),a(!1),h(null)},t)})(o)},0)}catch(e){console.error("Error sending message:",e),p((0,d.__)("Sorry, I encountered an error processing your request. Please try again.","wp-module-editor-chat")),a(!1),h(null)}},handleNewChat:async()=>{N(),a(!1),h(null),r([]),c(null),p(null),(()=>{try{const e=J();localStorage.removeItem(e.CONVERSATION_ID),localStorage.removeItem(e.MESSAGES)}catch(e){console.warn("Failed to clear chat data from localStorage:",e)}})();try{const e=await V();e.conversationId&&c(e.conversationId)}catch(e){console.error("Failed to create new conversation:",e)}},handleAcceptChanges:async()=>{if(g(!0),y)try{const e=v?v():void 0;e&&await S("root","globalStyles",e)}catch(e){console.error("Error saving global styles:",e)}E&&E()},handleDeclineChanges:async()=>{const e=n.find(e=>e.hasActions&&e.undoData);if(e&&e.undoData)try{const t=e.undoData;t&&"object"==typeof t&&!Array.isArray(t)?(t.blocks&&Array.isArray(t.blocks)&&t.blocks.length>0&&await K.restoreBlocks(t.blocks),t.globalStyles&&t.globalStyles.originalStyles&&t.globalStyles.globalStylesId&&await K.restoreGlobalStyles(t.globalStyles)):Array.isArray(t)&&await K.restoreBlocks(t),r(e=>e.map(e=>{if(e.hasActions){const{hasActions:t,undoData:n,...r}=e;return r}return e})),w(!1)}catch(e){console.error("Error restoring changes:",e)}else console.error("No undo data available")},handleStopRequest:()=>{N(),a(!1),h(null),p(null)}}},ee=window.wp.components,te=window.React,ne=(...e)=>e.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim();var re={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const oe=(0,te.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:o="",children:a,iconNode:s,...i},c)=>(0,te.createElement)("svg",{ref:c,...re,width:t,height:t,stroke:e,strokeWidth:r?24*Number(n)/Number(t):n,className:ne("lucide",o),...i},[...s.map(([e,t])=>(0,te.createElement)(e,t)),...Array.isArray(a)?a:[a]])),ae=(e,t)=>{const n=(0,te.forwardRef)(({className:n,...r},o)=>{return(0,te.createElement)(oe,{ref:o,iconNode:t,className:ne(`lucide-${a=e,a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,n),...r});var a});return n.displayName=`${e}`,n},se=ae("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),ie=ae("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),ce=window.ReactJSXRuntime,le=({pendingCount:e,onAccept:t,onDecline:n,isSaving:r})=>{const o=1===e?"change":"changes";return(0,ce.jsxs)("div",{className:"nfd-editor-chat-action-buttons",children:[(0,ce.jsxs)("div",{className:"nfd-editor-chat-action-buttons__indicator",children:[(0,ce.jsx)("span",{className:"nfd-editor-chat-action-buttons__indicator-dot"}),e," pending ",o]}),(0,ce.jsxs)("div",{className:"nfd-editor-chat-action-buttons__buttons",children:[(0,ce.jsxs)(ee.Button,{className:"nfd-editor-chat-action-buttons__button nfd-editor-chat-action-buttons__button--decline",onClick:n,disabled:r,children:[(0,ce.jsx)(se,{size:12}),"Revert All"]}),(0,ce.jsxs)(ee.Button,{className:"nfd-editor-chat-action-buttons__button nfd-editor-chat-action-buttons__button--accept",onClick:t,disabled:r,children:[(0,ce.jsx)(ie,{size:14}),"Keep Changes"]})]})]})},de=ae("CircleStop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]]),ue=ae("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),pe=ae("AtSign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),me=({block:e,onRemove:t})=>{if(!e)return null;const n=(r=e.name)?r.split("/").pop().split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"";var r;const o=e.attributes?.metadata?.name,a=e.name.split("/").pop(),s=["paragraph","heading"].includes(a),i=e.attributes?.content,c=s?(l=i)&&l.replace(/<[^>]*>/g,"").trim()||null:null;var l;let u=n;o?u=`${n}: ${o}`:c&&(u=`${n}: ${c}`);const p=u;return u.length>30&&(u=`${u.substring(0,30)}...`),(0,ce.jsxs)("div",{className:"nfd-editor-chat-context-tag",title:p,children:[(0,ce.jsx)("span",{className:"nfd-editor-chat-context-tag__label",children:(0,ce.jsx)(pe,{size:12})}),t&&(0,ce.jsx)("button",{className:"nfd-editor-chat-context-tag__remove",onClick:()=>t(e.clientId),"aria-label":(0,d.__)("Remove context","wp-module-editor-chat"),children:(0,ce.jsx)(se,{size:12})}),(0,ce.jsx)("span",{className:"nfd-editor-chat-context-tag__block",children:u})]})},he=({onSendMessage:e,onStopRequest:t,disabled:n=!1})=>{const[r,o]=(0,l.useState)(""),a=(0,l.useRef)(null),s=(0,i.useSelect)(()=>$(),[]),{clearSelectedBlock:c}=(0,i.useDispatch)("core/block-editor");(0,l.useEffect)(()=>{if(a.current){a.current.style.height="auto";const e=Math.min(a.current.scrollHeight,200);a.current.style.height=`${e}px`}},[r]),(0,l.useEffect)(()=>{!n&&a.current&&setTimeout(()=>{a.current.focus()},100)},[n]);const u=()=>{r.trim()&&!n&&(e(r),o(""),a.current&&(a.current.style.height="auto",a.current.focus()))};return(0,ce.jsxs)("div",{className:"nfd-editor-chat-input",children:[(0,ce.jsxs)("div",{className:"nfd-editor-chat-input__container",children:[(0,ce.jsx)("textarea",{name:"nfd-editor-chat-input",ref:a,value:r,onChange:e=>o(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),u())},placeholder:(0,d.__)("How can I help you today?","wp-module-editor-chat"),className:"nfd-editor-chat-input__textarea",rows:1,disabled:n}),(0,ce.jsxs)("div",{className:"nfd-editor-chat-input__actions",children:[s&&(0,ce.jsx)(me,{block:s,onRemove:e=>{c(e)}}),n?(0,ce.jsx)(ee.Button,{icon:(0,ce.jsx)(de,{width:16,height:16}),label:(0,d.__)("Stop generating","wp-module-editor-chat"),onClick:t,className:"nfd-editor-chat-input__stop"}):(0,ce.jsx)(ee.Button,{icon:(0,ce.jsx)(ue,{width:16,height:16}),label:(0,d.__)("Send message","wp-module-editor-chat"),onClick:u,className:"nfd-editor-chat-input__submit",disabled:!r.trim()})]})]}),(0,ce.jsx)("div",{className:"nfd-editor-chat-input__disclaimer",children:(0,d.__)("AI-generated content is not guaranteed for accuracy.","wp-module-editor-chat")})]})},fe=ae("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),ge=({message:e,className:t=""})=>(0,ce.jsxs)("div",{className:`nfd-editor-chat-error-alert ${t}`,children:[(0,ce.jsx)("div",{className:"nfd-editor-chat-error-alert__icon",children:(0,ce.jsx)(fe,{width:16,height:16})}),(0,ce.jsx)("div",{className:"nfd-editor-chat-error-alert__content",children:(0,ce.jsx)("div",{className:"nfd-editor-chat-error-alert__message",children:e})})]}),ye=({status:e=null})=>(0,ce.jsx)("div",{className:"nfd-editor-chat-message nfd-editor-chat-message--assistant",children:(0,ce.jsx)("div",{className:"nfd-editor-chat-message__content",children:(0,ce.jsxs)("div",{className:"nfd-editor-chat-typing-indicator",children:[(0,ce.jsx)("div",{className:"nfd-editor-chat-typing-indicator__loader"}),e&&(0,ce.jsx)("div",{className:"nfd-editor-chat-typing-indicator__status",children:(()=>{switch(e){case"received":return(0,d.__)("Message received…","wp-module-editor-chat");case"generating":return(0,d.__)("Generating response…","wp-module-editor-chat");case"completed":return(0,d.__)("Processing…","wp-module-editor-chat");case"failed":return(0,d.__)("Error occurred","wp-module-editor-chat");default:return(0,d.__)("Thinking…","wp-module-editor-chat")}})()})]})})}),{entries:we,setPrototypeOf:be,isFrozen:_e,getPrototypeOf:ke,getOwnPropertyDescriptor:Ae}=Object;let{freeze:Ee,seal:Se,create:ve}=Object,{apply:Te,construct:Ne}="undefined"!=typeof Reflect&&Reflect;Ee||(Ee=function(e){return e}),Se||(Se=function(e){return e}),Te||(Te=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return e.apply(t,r)}),Ne||(Ne=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new e(...n)});const xe=$e(Array.prototype.forEach),Ie=$e(Array.prototype.lastIndexOf),Ce=$e(Array.prototype.pop),Re=$e(Array.prototype.push),De=$e(Array.prototype.splice),Me=$e(String.prototype.toLowerCase),Oe=$e(String.prototype.toString),Le=$e(String.prototype.match),Be=$e(String.prototype.replace),Pe=$e(String.prototype.indexOf),je=$e(String.prototype.trim),Fe=$e(Object.prototype.hasOwnProperty),ze=$e(RegExp.prototype.test),Ue=(He=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ne(He,t)});var He;function $e(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return Te(e,t,r)}}function Ge(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Me;be&&be(e,null);let r=t.length;for(;r--;){let o=t[r];if("string"==typeof o){const e=n(o);e!==o&&(_e(t)||(t[r]=e),o=e)}e[o]=!0}return e}function We(e){for(let t=0;t<e.length;t++)Fe(e,t)||(e[t]=null);return e}function qe(e){const t=ve(null);for(const[n,r]of we(e))Fe(e,n)&&(Array.isArray(r)?t[n]=We(r):r&&"object"==typeof r&&r.constructor===Object?t[n]=qe(r):t[n]=r);return t}function Ye(e,t){for(;null!==e;){const n=Ae(e,t);if(n){if(n.get)return $e(n.get);if("function"==typeof n.value)return $e(n.value)}e=ke(e)}return function(){return null}}const Ve=Ee(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Xe=Ee(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Ke=Ee(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Je=Ee(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Ze=Ee(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Qe=Ee(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),et=Ee(["#text"]),tt=Ee(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),nt=Ee(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),rt=Ee(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),ot=Ee(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),at=Se(/\{\{[\w\W]*|[\w\W]*\}\}/gm),st=Se(/<%[\w\W]*|[\w\W]*%>/gm),it=Se(/\$\{[\w\W]*/gm),ct=Se(/^data-[\-\w.\u00B7-\uFFFF]+$/),lt=Se(/^aria-[\-\w]+$/),dt=Se(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ut=Se(/^(?:\w+script|data):/i),pt=Se(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),mt=Se(/^html$/i),ht=Se(/^[a-z][.\w]*(-[.\w]+)+$/i);var ft=Object.freeze({__proto__:null,ARIA_ATTR:lt,ATTR_WHITESPACE:pt,CUSTOM_ELEMENT:ht,DATA_ATTR:ct,DOCTYPE_NAME:mt,ERB_EXPR:st,IS_ALLOWED_URI:dt,IS_SCRIPT_OR_DATA:ut,MUSTACHE_EXPR:at,TMPLIT_EXPR:it});const gt=function(){return"undefined"==typeof window?null:window};var yt=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gt();const n=t=>e(t);if(n.version="3.3.0",n.removed=[],!t||!t.document||9!==t.document.nodeType||!t.Element)return n.isSupported=!1,n;let{document:r}=t;const o=r,a=o.currentScript,{DocumentFragment:s,HTMLTemplateElement:i,Node:c,Element:l,NodeFilter:d,NamedNodeMap:u=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:p,DOMParser:m,trustedTypes:h}=t,f=l.prototype,g=Ye(f,"cloneNode"),y=Ye(f,"remove"),w=Ye(f,"nextSibling"),b=Ye(f,"childNodes"),_=Ye(f,"parentNode");if("function"==typeof i){const e=r.createElement("template");e.content&&e.content.ownerDocument&&(r=e.content.ownerDocument)}let k,A="";const{implementation:E,createNodeIterator:S,createDocumentFragment:v,getElementsByTagName:T}=r,{importNode:N}=o;let x={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};n.isSupported="function"==typeof we&&"function"==typeof _&&E&&void 0!==E.createHTMLDocument;const{MUSTACHE_EXPR:I,ERB_EXPR:C,TMPLIT_EXPR:R,DATA_ATTR:D,ARIA_ATTR:M,IS_SCRIPT_OR_DATA:O,ATTR_WHITESPACE:L,CUSTOM_ELEMENT:B}=ft;let{IS_ALLOWED_URI:P}=ft,j=null;const F=Ge({},[...Ve,...Xe,...Ke,...Ze,...et]);let z=null;const U=Ge({},[...tt,...nt,...rt,...ot]);let H=Object.seal(ve(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),$=null,G=null;const W=Object.seal(ve(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let q=!0,Y=!0,V=!1,X=!0,K=!1,J=!0,Z=!1,Q=!1,ee=!1,te=!1,ne=!1,re=!1,oe=!0,ae=!1,se=!0,ie=!1,ce={},le=null;const de=Ge({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ue=null;const pe=Ge({},["audio","video","img","source","image","track"]);let me=null;const he=Ge({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),fe="http://www.w3.org/1998/Math/MathML",ge="http://www.w3.org/2000/svg",ye="http://www.w3.org/1999/xhtml";let be=ye,_e=!1,ke=null;const Ae=Ge({},[fe,ge,ye],Oe);let Se=Ge({},["mi","mo","mn","ms","mtext"]),Te=Ge({},["annotation-xml"]);const Ne=Ge({},["title","style","font","a","script"]);let He=null;const $e=["application/xhtml+xml","text/html"];let We=null,at=null;const st=r.createElement("form"),it=function(e){return e instanceof RegExp||e instanceof Function},ct=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!at||at!==e){if(e&&"object"==typeof e||(e={}),e=qe(e),He=-1===$e.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,We="application/xhtml+xml"===He?Oe:Me,j=Fe(e,"ALLOWED_TAGS")?Ge({},e.ALLOWED_TAGS,We):F,z=Fe(e,"ALLOWED_ATTR")?Ge({},e.ALLOWED_ATTR,We):U,ke=Fe(e,"ALLOWED_NAMESPACES")?Ge({},e.ALLOWED_NAMESPACES,Oe):Ae,me=Fe(e,"ADD_URI_SAFE_ATTR")?Ge(qe(he),e.ADD_URI_SAFE_ATTR,We):he,ue=Fe(e,"ADD_DATA_URI_TAGS")?Ge(qe(pe),e.ADD_DATA_URI_TAGS,We):pe,le=Fe(e,"FORBID_CONTENTS")?Ge({},e.FORBID_CONTENTS,We):de,$=Fe(e,"FORBID_TAGS")?Ge({},e.FORBID_TAGS,We):qe({}),G=Fe(e,"FORBID_ATTR")?Ge({},e.FORBID_ATTR,We):qe({}),ce=!!Fe(e,"USE_PROFILES")&&e.USE_PROFILES,q=!1!==e.ALLOW_ARIA_ATTR,Y=!1!==e.ALLOW_DATA_ATTR,V=e.ALLOW_UNKNOWN_PROTOCOLS||!1,X=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,K=e.SAFE_FOR_TEMPLATES||!1,J=!1!==e.SAFE_FOR_XML,Z=e.WHOLE_DOCUMENT||!1,te=e.RETURN_DOM||!1,ne=e.RETURN_DOM_FRAGMENT||!1,re=e.RETURN_TRUSTED_TYPE||!1,ee=e.FORCE_BODY||!1,oe=!1!==e.SANITIZE_DOM,ae=e.SANITIZE_NAMED_PROPS||!1,se=!1!==e.KEEP_CONTENT,ie=e.IN_PLACE||!1,P=e.ALLOWED_URI_REGEXP||dt,be=e.NAMESPACE||ye,Se=e.MATHML_TEXT_INTEGRATION_POINTS||Se,Te=e.HTML_INTEGRATION_POINTS||Te,H=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&it(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(H.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&it(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(H.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(H.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),K&&(Y=!1),ne&&(te=!0),ce&&(j=Ge({},et),z=[],!0===ce.html&&(Ge(j,Ve),Ge(z,tt)),!0===ce.svg&&(Ge(j,Xe),Ge(z,nt),Ge(z,ot)),!0===ce.svgFilters&&(Ge(j,Ke),Ge(z,nt),Ge(z,ot)),!0===ce.mathMl&&(Ge(j,Ze),Ge(z,rt),Ge(z,ot))),e.ADD_TAGS&&("function"==typeof e.ADD_TAGS?W.tagCheck=e.ADD_TAGS:(j===F&&(j=qe(j)),Ge(j,e.ADD_TAGS,We))),e.ADD_ATTR&&("function"==typeof e.ADD_ATTR?W.attributeCheck=e.ADD_ATTR:(z===U&&(z=qe(z)),Ge(z,e.ADD_ATTR,We))),e.ADD_URI_SAFE_ATTR&&Ge(me,e.ADD_URI_SAFE_ATTR,We),e.FORBID_CONTENTS&&(le===de&&(le=qe(le)),Ge(le,e.FORBID_CONTENTS,We)),se&&(j["#text"]=!0),Z&&Ge(j,["html","head","body"]),j.table&&(Ge(j,["tbody"]),delete $.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw Ue('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw Ue('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');k=e.TRUSTED_TYPES_POLICY,A=k.createHTML("")}else void 0===k&&(k=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let n=null;const r="data-tt-policy-suffix";t&&t.hasAttribute(r)&&(n=t.getAttribute(r));const o="dompurify"+(n?"#"+n:"");try{return e.createPolicy(o,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+o+" could not be created."),null}}(h,a)),null!==k&&"string"==typeof A&&(A=k.createHTML(""));Ee&&Ee(e),at=e}},lt=Ge({},[...Xe,...Ke,...Je]),ut=Ge({},[...Ze,...Qe]),pt=function(e){Re(n.removed,{element:e});try{_(e).removeChild(e)}catch(t){y(e)}},ht=function(e,t){try{Re(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){Re(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(te||ne)try{pt(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},yt=function(e){let t=null,n=null;if(ee)e="<remove></remove>"+e;else{const t=Le(e,/^[\r\n\t ]+/);n=t&&t[0]}"application/xhtml+xml"===He&&be===ye&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const o=k?k.createHTML(e):e;if(be===ye)try{t=(new m).parseFromString(o,He)}catch(e){}if(!t||!t.documentElement){t=E.createDocument(be,"template",null);try{t.documentElement.innerHTML=_e?A:o}catch(e){}}const a=t.body||t.documentElement;return e&&n&&a.insertBefore(r.createTextNode(n),a.childNodes[0]||null),be===ye?T.call(t,Z?"html":"body")[0]:Z?t.documentElement:a},wt=function(e){return S.call(e.ownerDocument||e,e,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},bt=function(e){return e instanceof p&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof u)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},_t=function(e){return"function"==typeof c&&e instanceof c};function kt(e,t,r){xe(e,e=>{e.call(n,t,r,at)})}const At=function(e){let t=null;if(kt(x.beforeSanitizeElements,e,null),bt(e))return pt(e),!0;const r=We(e.nodeName);if(kt(x.uponSanitizeElement,e,{tagName:r,allowedTags:j}),J&&e.hasChildNodes()&&!_t(e.firstElementChild)&&ze(/<[/\w!]/g,e.innerHTML)&&ze(/<[/\w!]/g,e.textContent))return pt(e),!0;if(7===e.nodeType)return pt(e),!0;if(J&&8===e.nodeType&&ze(/<[/\w]/g,e.data))return pt(e),!0;if(!(W.tagCheck instanceof Function&&W.tagCheck(r))&&(!j[r]||$[r])){if(!$[r]&&St(r)){if(H.tagNameCheck instanceof RegExp&&ze(H.tagNameCheck,r))return!1;if(H.tagNameCheck instanceof Function&&H.tagNameCheck(r))return!1}if(se&&!le[r]){const t=_(e)||e.parentNode,n=b(e)||e.childNodes;if(n&&t)for(let r=n.length-1;r>=0;--r){const o=g(n[r],!0);o.__removalCount=(e.__removalCount||0)+1,t.insertBefore(o,w(e))}}return pt(e),!0}return e instanceof l&&!function(e){let t=_(e);t&&t.tagName||(t={namespaceURI:be,tagName:"template"});const n=Me(e.tagName),r=Me(t.tagName);return!!ke[e.namespaceURI]&&(e.namespaceURI===ge?t.namespaceURI===ye?"svg"===n:t.namespaceURI===fe?"svg"===n&&("annotation-xml"===r||Se[r]):Boolean(lt[n]):e.namespaceURI===fe?t.namespaceURI===ye?"math"===n:t.namespaceURI===ge?"math"===n&&Te[r]:Boolean(ut[n]):e.namespaceURI===ye?!(t.namespaceURI===ge&&!Te[r])&&!(t.namespaceURI===fe&&!Se[r])&&!ut[n]&&(Ne[n]||!lt[n]):!("application/xhtml+xml"!==He||!ke[e.namespaceURI]))}(e)?(pt(e),!0):"noscript"!==r&&"noembed"!==r&&"noframes"!==r||!ze(/<\/no(script|embed|frames)/i,e.innerHTML)?(K&&3===e.nodeType&&(t=e.textContent,xe([I,C,R],e=>{t=Be(t,e," ")}),e.textContent!==t&&(Re(n.removed,{element:e.cloneNode()}),e.textContent=t)),kt(x.afterSanitizeElements,e,null),!1):(pt(e),!0)},Et=function(e,t,n){if(oe&&("id"===t||"name"===t)&&(n in r||n in st))return!1;if(Y&&!G[t]&&ze(D,t));else if(q&&ze(M,t));else if(W.attributeCheck instanceof Function&&W.attributeCheck(t,e));else if(!z[t]||G[t]){if(!(St(e)&&(H.tagNameCheck instanceof RegExp&&ze(H.tagNameCheck,e)||H.tagNameCheck instanceof Function&&H.tagNameCheck(e))&&(H.attributeNameCheck instanceof RegExp&&ze(H.attributeNameCheck,t)||H.attributeNameCheck instanceof Function&&H.attributeNameCheck(t,e))||"is"===t&&H.allowCustomizedBuiltInElements&&(H.tagNameCheck instanceof RegExp&&ze(H.tagNameCheck,n)||H.tagNameCheck instanceof Function&&H.tagNameCheck(n))))return!1}else if(me[t]);else if(ze(P,Be(n,L,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==Pe(n,"data:")||!ue[e])if(V&&!ze(O,Be(n,L,"")));else if(n)return!1;return!0},St=function(e){return"annotation-xml"!==e&&Le(e,B)},vt=function(e){kt(x.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||bt(e))return;const r={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:z,forceKeepAttr:void 0};let o=t.length;for(;o--;){const a=t[o],{name:s,namespaceURI:i,value:c}=a,l=We(s),d=c;let u="value"===s?d:je(d);if(r.attrName=l,r.attrValue=u,r.keepAttr=!0,r.forceKeepAttr=void 0,kt(x.uponSanitizeAttribute,e,r),u=r.attrValue,!ae||"id"!==l&&"name"!==l||(ht(s,e),u="user-content-"+u),J&&ze(/((--!?|])>)|<\/(style|title|textarea)/i,u)){ht(s,e);continue}if("attributename"===l&&Le(u,"href")){ht(s,e);continue}if(r.forceKeepAttr)continue;if(!r.keepAttr){ht(s,e);continue}if(!X&&ze(/\/>/i,u)){ht(s,e);continue}K&&xe([I,C,R],e=>{u=Be(u,e," ")});const p=We(e.nodeName);if(Et(p,l,u)){if(k&&"object"==typeof h&&"function"==typeof h.getAttributeType)if(i);else switch(h.getAttributeType(p,l)){case"TrustedHTML":u=k.createHTML(u);break;case"TrustedScriptURL":u=k.createScriptURL(u)}if(u!==d)try{i?e.setAttributeNS(i,s,u):e.setAttribute(s,u),bt(e)?pt(e):Ce(n.removed)}catch(t){ht(s,e)}}else ht(s,e)}kt(x.afterSanitizeAttributes,e,null)},Tt=function e(t){let n=null;const r=wt(t);for(kt(x.beforeSanitizeShadowDOM,t,null);n=r.nextNode();)kt(x.uponSanitizeShadowNode,n,null),At(n),vt(n),n.content instanceof s&&e(n.content);kt(x.afterSanitizeShadowDOM,t,null)};return n.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=null,a=null,i=null,l=null;if(_e=!e,_e&&(e="\x3c!--\x3e"),"string"!=typeof e&&!_t(e)){if("function"!=typeof e.toString)throw Ue("toString is not a function");if("string"!=typeof(e=e.toString()))throw Ue("dirty is not a string, aborting")}if(!n.isSupported)return e;if(Q||ct(t),n.removed=[],"string"==typeof e&&(ie=!1),ie){if(e.nodeName){const t=We(e.nodeName);if(!j[t]||$[t])throw Ue("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof c)r=yt("\x3c!----\x3e"),a=r.ownerDocument.importNode(e,!0),1===a.nodeType&&"BODY"===a.nodeName||"HTML"===a.nodeName?r=a:r.appendChild(a);else{if(!te&&!K&&!Z&&-1===e.indexOf("<"))return k&&re?k.createHTML(e):e;if(r=yt(e),!r)return te?null:re?A:""}r&&ee&&pt(r.firstChild);const d=wt(ie?e:r);for(;i=d.nextNode();)At(i),vt(i),i.content instanceof s&&Tt(i.content);if(ie)return e;if(te){if(ne)for(l=v.call(r.ownerDocument);r.firstChild;)l.appendChild(r.firstChild);else l=r;return(z.shadowroot||z.shadowrootmode)&&(l=N.call(o,l,!0)),l}let u=Z?r.outerHTML:r.innerHTML;return Z&&j["!doctype"]&&r.ownerDocument&&r.ownerDocument.doctype&&r.ownerDocument.doctype.name&&ze(mt,r.ownerDocument.doctype.name)&&(u="<!DOCTYPE "+r.ownerDocument.doctype.name+">\n"+u),K&&xe([I,C,R],e=>{u=Be(u,e," ")}),k&&re?k.createHTML(u):u},n.setConfig=function(){ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Q=!0},n.clearConfig=function(){at=null,Q=!1},n.isValidAttribute=function(e,t,n){at||ct({});const r=We(e),o=We(t);return Et(r,o,n)},n.addHook=function(e,t){"function"==typeof t&&Re(x[e],t)},n.removeHook=function(e,t){if(void 0!==t){const n=Ie(x[e],t);return-1===n?void 0:De(x[e],n,1)[0]}return Ce(x[e])},n.removeHooks=function(e){x[e]=[]},n.removeAllHooks=function(){x={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},n}();const wt=e=>/<[a-z][\s\S]*>/i.test(e),bt=({message:e,type:t="assistant"})=>{const n="user"===t,r=(0,l.useMemo)(()=>e?n?e:wt(e)?(e=>yt.sanitize(e,{ALLOWED_TAGS:["section","div","h1","h2","h3","h4","h5","h6","p","span","strong","em","b","i","u","s","mark","small","sub","sup","a","br","ul","ol","li","dl","dt","dd","blockquote","code","pre","table","thead","tbody","tr","th","td","hr","address","time"],ALLOWED_ATTR:["style","class","id","href","datetime"],ALLOW_DATA_ATTR:!1,FORBID_TAGS:["script","object","embed","iframe","form","fieldset","legend","label","input","textarea","select","option","button","details","summary","progress","meter"],FORBID_ATTR:["onerror","onload","onclick","onmouseover","onfocus","onblur"]}))(e):e:"",[e,n]),o=!n&&wt(e);return(0,ce.jsx)("div",{className:`nfd-editor-chat-message nfd-editor-chat-message--${t}`,children:o?(0,ce.jsx)("div",{className:"nfd-editor-chat-message__content",dangerouslySetInnerHTML:{__html:r}}):(0,ce.jsx)("div",{className:"nfd-editor-chat-message__content",children:r})})},_t=({messages:e=[],isLoading:t=!1,error:n=null,status:r=null})=>{const o=(0,l.useRef)(null);return(0,l.useEffect)(()=>{o.current?.scrollIntoView({behavior:"smooth"})},[e,t]),(0,ce.jsxs)("div",{className:"nfd-editor-chat-messages",children:[e.length&&e.map((e,t)=>(0,ce.jsx)(bt,{message:e.content,type:e.type},t)),n&&(0,ce.jsx)(ge,{message:n}),t&&(0,ce.jsx)(ye,{status:r}),(0,ce.jsx)("div",{ref:o})]})};var kt;function At(){return At=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},At.apply(null,arguments)}ae("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]),ae("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),ae("FilePlus",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]]),ae("Layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]);var Et=function(e){return te.createElement("svg",At({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,baseProfile:"basic",viewBox:"0 0 30 30"},e),kt||(kt=te.createElement("path",{d:"m14.217 19.707-1.112 2.547a1.199 1.199 0 0 1-2.21 0l-1.112-2.547A9.8 9.8 0 0 0 4.79 14.65l-3.06-1.358c-.973-.432-.973-1.848 0-2.28l2.965-1.316C6.974 8.684 8.787 6.813 9.76 4.47l1.126-2.714a1.2 1.2 0 0 1 2.228 0L14.24 4.47c.973 2.344 2.786 4.215 5.065 5.226l2.965 1.316c.973.432.973 1.848 0 2.28l-3.061 1.359a9.8 9.8 0 0 0-4.992 5.056M24.481 27.796l-.339.777a.696.696 0 0 1-1.284 0l-.339-.777a6 6 0 0 0-3.051-3.092l-1.044-.464c-.565-.251-.565-1.072 0-1.323l.986-.438a6 6 0 0 0 3.095-3.195l.348-.84a.696.696 0 0 1 1.294 0l.348.84a6 6 0 0 0 3.095 3.195l.986.438c.565.251.565 1.072 0 1.323l-1.044.464a6 6 0 0 0-3.051 3.092"})))};const St=({width:e=24,height:t=24})=>(0,ce.jsx)("div",{className:"nfd-editor-chat-ai-avatar",style:{width:e,height:t},children:(0,ce.jsx)(Et,{width:.625*e,height:.625*t})}),vt=({onSendMessage:e})=>((0,d.__)("Add a new section","wp-module-editor-chat"),(0,d.__)("Update color scheme","wp-module-editor-chat"),(0,d.__)("Create new page","wp-module-editor-chat"),(0,d.__)("Edit content","wp-module-editor-chat"),(0,ce.jsxs)("div",{className:"nfd-editor-chat-welcome",children:[(0,ce.jsxs)("div",{className:"nfd-editor-chat-welcome__content",children:[(0,ce.jsx)("div",{className:"nfd-editor-chat-welcome__avatar",children:(0,ce.jsx)(St,{width:48,height:48})}),(0,ce.jsxs)("div",{className:"nfd-editor-chat-welcome__message",children:[(0,ce.jsx)("div",{className:"nfd-editor-chat-welcome__title",children:(0,d.__)("Hi, I'm BLU, your AI assistant.","wp-module-editor-chat")}),(0,ce.jsx)("div",{className:"nfd-editor-chat-welcome__subtitle",children:(0,d.__)("I can help you update page sections and styles,","wp-module-editor-chat")}),(0,ce.jsx)("div",{className:"nfd-editor-chat-welcome__subtitle",children:(0,d.__)("add, remove, or edit existing content.","wp-module-editor-chat")})]})]}),(0,ce.jsx)("div",{className:"nfd-editor-chat-suggestions",children:!1})]})),Tt=ae("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),Nt=ae("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),xt=({onNewChat:e,isNewChatDisabled:t=!1})=>(0,ce.jsxs)("div",{className:"nfd-editor-chat-sidebar__header-content",children:[(0,ce.jsxs)("div",{className:"interface-complementary-area-header__title",children:[(0,ce.jsx)(Tt,{width:15,height:15}),(0,ce.jsxs)("h2",{children:[(0,d.__)("Blu Chat","wp-module-editor-chat"),(0,ce.jsx)("span",{className:"nfd-editor-chat-sidebar__beta-badge",children:"Beta"})]})]}),e&&(0,ce.jsx)("div",{className:"nfd-editor-chat-sidebar__header-actions",children:(0,ce.jsx)(ee.Button,{icon:(0,ce.jsx)(Nt,{width:16,height:16}),label:(0,d.__)("New chat","wp-module-editor-chat"),onClick:e,className:"nfd-editor-chat-sidebar__new-chat",disabled:t})})]}),It="nfd-editor-chat",Ct="core",Rt=()=>{const{enableComplementaryArea:e}=(0,i.useDispatch)(D),{messages:t,isLoading:n,error:r,status:o,isSaving:a,handleSendMessage:s,handleNewChat:u,handleAcceptChanges:p,handleDeclineChanges:m,handleStopRequest:h}=Q();(0,l.useEffect)(()=>{e(Ct,It)},[e]);const f=t.filter(e=>e.hasActions).length,g=f>0,y=0===t.length;return(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsx)(c.PluginSidebarMoreMenuItem,{scope:Ct,target:It,icon:(0,ce.jsx)(St,{width:24,height:24}),children:(0,d.__)("AI Chat Editor","wp-module-editor-chat")}),(0,ce.jsx)(c.PluginSidebar,{scope:Ct,identifier:It,className:"nfd-editor-chat-sidebar",closeLabel:(0,d.__)("Close AI Chat Editor","wp-module-editor-chat"),icon:(0,ce.jsx)(St,{width:24,height:24}),headerClassName:"nfd-editor-chat-sidebar__header",panelClassName:"nfd-editor-chat-sidebar__panel",header:(0,ce.jsx)(xt,{onNewChat:u,isNewChatDisabled:y}),children:(0,ce.jsxs)("div",{className:"nfd-editor-chat-sidebar__content",children:[0===t.length?(0,ce.jsx)(vt,{onSendMessage:s}):(0,ce.jsx)(_t,{messages:t,isLoading:n,error:r,status:o}),g&&(0,ce.jsx)(le,{pendingCount:f,onAccept:p,onDecline:m,isSaving:a}),(0,ce.jsx)(he,{onSendMessage:s,onStopRequest:h,disabled:n})]})})]})};a()(()=>{(0,s.registerPlugin)("nfd-editor-chat",{render:Rt})}),((((window.newfold=window.newfold||{}).wordpress=window.newfold.wordpress||{}).editor=window.newfold.wordpress.editor||{}).chat=window.newfold.wordpress.editor.chat||{})["chat-editor"]=t})();